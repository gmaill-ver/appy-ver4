<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Â≠¶Áøí„Éà„É©„ÉÉ„Ç´„Éº Pro - Ë°åÊîøÊõ∏Â£´Ë©¶È®ìÂØæÁ≠ñ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        :root {
            --primary: #2c3e50;
            --primary-light: #34495e;
            --secondary: #3498db;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --dark: #1f2937;
            --gray: #6b7280;
            --gray-light: #9ca3af;
            --light: #f3f4f6;
            --lighter: #f9fafb;
            --white: #ffffff;
            --shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1);
            --purple: #8b5cf6;
            --pink: #ec4899;
            --indigo: #6366f1;
            --teal: #14b8a6;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Hiragino Sans', 'Noto Sans CJK JP', sans-serif;
            background: var(--lighter);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            position: relative;
        }
        
        /* „Éò„ÉÉ„ÉÄ„Éº */
        .app-header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            padding: 20px;
            text-align: center;
            color: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: relative;
        }
        
        .app-logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-bottom: 5px;
        }
        
        .app-logo-icon {
            font-size: 24px;
        }
        
        .app-title {
            font-size: 22px;
            font-weight: 700;
        }
        
        .app-subtitle {
            font-size: 14px;
            opacity: 0.9;
        }
        
        /* „ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ„Ç¶„Ç£„Ç∏„Çß„ÉÉ„Éà */
        .dashboard-widget {
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex;
            gap: 5px;
        }
        
        .widget-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            padding: 5px 8px;
            border-radius: 5px;
            color: white;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s;
        }
        
        .widget-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        
        /* „É°„Ç§„É≥„Çø„ÉñÔºàÊã°ÂºµÁâàÔºâ */
        .main-tabs {
            display: flex;
            background: white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
            overflow-x: auto;
            scrollbar-width: none;
        }
        
        .main-tabs::-webkit-scrollbar {
            display: none;
        }
        
        .main-tab {
            flex: 1;
            min-width: 80px;
            padding: 15px;
            text-align: center;
            border: none;
            background: white;
            color: var(--gray);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            white-space: nowrap;
        }
        
        .main-tab.active {
            color: var(--primary);
        }
        
        .main-tab.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--primary);
        }
        
        /* „Çø„Ç§„Éû„ÉºË°®Á§∫ */
        .timer-display {
            position: fixed;
            top: 100px;
            right: 20px;
            background: white;
            border-radius: 15px;
            padding: 15px;
            box-shadow: var(--shadow-lg);
            z-index: 1000;
            display: none;
        }
        
        .timer-display.active {
            display: block;
        }
        
        .timer-time {
            font-size: 24px;
            font-weight: 700;
            text-align: center;
            margin-bottom: 10px;
        }
        
        .timer-controls {
            display: flex;
            gap: 5px;
        }
        
        .timer-btn {
            flex: 1;
            padding: 5px;
            border: none;
            border-radius: 5px;
            background: var(--primary);
            color: white;
            cursor: pointer;
            font-size: 12px;
        }
        
        .timer-btn.pause {
            background: var(--warning);
        }
        
        .timer-btn.stop {
            background: var(--danger);
        }
        
        /* „Éù„É¢„Éâ„Éº„É≠Ë®≠ÂÆö */
        .pomodoro-settings {
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid var(--light);
        }
        
        .pomodoro-status {
            font-size: 12px;
            text-align: center;
            color: var(--gray);
            margin-bottom: 5px;
        }
        
        .pomodoro-progress {
            display: flex;
            gap: 3px;
            justify-content: center;
        }
        
        .pomodoro-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--light);
        }
        
        .pomodoro-dot.completed {
            background: var(--success);
        }
        
        .pomodoro-dot.current {
            background: var(--warning);
            animation: pulse 1s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }
        
        /* „Ç´„É¨„É≥„ÉÄ„Éº„Éì„É•„Éº */
        .calendar-container {
            background: white;
            border-radius: 15px;
            padding: 15px;
            margin: 10px;
        }
        
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .calendar-nav {
            display: flex;
            gap: 10px;
        }
        
        .calendar-nav-btn {
            padding: 5px 10px;
            border: 1px solid var(--light);
            border-radius: 5px;
            background: white;
            cursor: pointer;
        }
        
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 2px;
        }
        
        .calendar-day-header {
            text-align: center;
            font-size: 12px;
            font-weight: 600;
            color: var(--gray);
            padding: 5px;
        }
        
        .calendar-day {
            aspect-ratio: 1;
            border: 1px solid var(--light);
            border-radius: 5px;
            padding: 2px;
            font-size: 11px;
            position: relative;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .calendar-day:hover {
            background: var(--lighter);
        }
        
        .calendar-day.today {
            border-color: var(--primary);
            background: rgba(44, 62, 80, 0.05);
        }
        
        .calendar-day.has-data {
            background: linear-gradient(135deg, rgba(52, 152, 219, 0.1), rgba(46, 213, 115, 0.1));
        }
        
        .calendar-day-number {
            font-weight: 600;
        }
        
        .calendar-day-stats {
            font-size: 9px;
            color: var(--gray);
            margin-top: 2px;
        }
        
        .calendar-day-indicator {
            position: absolute;
            bottom: 2px;
            right: 2px;
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: var(--success);
        }
        
        /* ÁõÆÊ®ôË®≠ÂÆö„Éë„Éç„É´ */
        .goal-panel {
            background: linear-gradient(135deg, var(--purple), var(--pink));
            color: white;
            border-radius: 15px;
            padding: 20px;
            margin: 10px;
        }
        
        .goal-title {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 15px;
        }
        
        .goal-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }
        
        .goal-item {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            padding: 10px;
            text-align: center;
        }
        
        .goal-value {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 3px;
        }
        
        .goal-label {
            font-size: 11px;
            opacity: 0.9;
        }
        
        .goal-progress {
            margin-top: 5px;
            height: 4px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 2px;
            overflow: hidden;
        }
        
        .goal-progress-fill {
            height: 100%;
            background: white;
            transition: width 0.3s;
        }
        
        /* AIÊèêÊ°à„Éë„Éç„É´ */
        .ai-suggestion-panel {
            background: linear-gradient(135deg, var(--indigo), var(--teal));
            color: white;
            border-radius: 15px;
            padding: 20px;
            margin: 10px;
        }
        
        .ai-suggestion-title {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .ai-suggestion-icon {
            animation: float 3s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }
        
        .ai-suggestion-content {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 10px;
            margin-bottom: 10px;
        }
        
        .ai-suggestion-action {
            display: flex;
            gap: 10px;
        }
        
        .ai-action-btn {
            flex: 1;
            padding: 8px;
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            color: white;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.3s;
        }
        
        .ai-action-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        
        /* Âæ©Áøí„Çπ„Ç±„Ç∏„É•„Éº„É´ */
        .review-schedule {
            background: white;
            border-radius: 15px;
            padding: 15px;
            margin: 10px;
        }
        
        .review-timeline {
            position: relative;
            padding-left: 30px;
        }
        
        .review-timeline::before {
            content: '';
            position: absolute;
            left: 10px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: var(--light);
        }
        
        .review-item {
            position: relative;
            padding: 10px;
            margin-bottom: 15px;
            background: var(--lighter);
            border-radius: 10px;
            border-left: 3px solid var(--primary);
        }
        
        .review-item::before {
            content: '';
            position: absolute;
            left: -23px;
            top: 15px;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: var(--primary);
            border: 2px solid white;
        }
        
        .review-item.urgent {
            border-left-color: var(--danger);
            background: #fef2f2;
        }
        
        .review-item.urgent::before {
            background: var(--danger);
        }
        
        .review-date {
            font-size: 11px;
            color: var(--gray);
            margin-bottom: 3px;
        }
        
        .review-content {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .review-stats {
            font-size: 12px;
            color: var(--gray);
        }
        
        /* „Éé„Éº„ÉàÊ©üËÉΩ */
        .note-panel {
            background: white;
            border-radius: 15px;
            padding: 15px;
            margin: 10px;
        }
        
        .note-editor {
            width: 100%;
            min-height: 100px;
            padding: 10px;
            border: 1px solid var(--light);
            border-radius: 8px;
            font-size: 14px;
            resize: vertical;
        }
        
        .note-toolbar {
            display: flex;
            gap: 5px;
            margin-bottom: 10px;
            flex-wrap: wrap;
        }
        
        .note-tool-btn {
            padding: 5px 10px;
            border: 1px solid var(--light);
            border-radius: 5px;
            background: white;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s;
        }
        
        .note-tool-btn:hover {
            background: var(--light);
        }
        
        .note-tool-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }
        
        .note-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-top: 10px;
        }
        
        .note-tag {
            padding: 3px 8px;
            background: var(--light);
            border-radius: 12px;
            font-size: 11px;
            color: var(--dark);
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .note-tag:hover {
            background: var(--primary);
            color: white;
        }
        
        /* Ê®°Êì¨Ë©¶È®ì„É¢„Éº„Éâ */
        .exam-mode-container {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin: 10px;
        }
        
        .exam-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--light);
        }
        
        .exam-timer {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 18px;
            font-weight: 700;
            color: var(--danger);
        }
        
        .exam-timer-icon {
            animation: tick 1s steps(1) infinite;
        }
        
        @keyframes tick {
            0% { transform: rotate(0deg); }
            50% { transform: rotate(10deg); }
        }
        
        .exam-progress-bar {
            height: 8px;
            background: var(--light);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 20px;
        }
        
        .exam-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--success), var(--primary));
            transition: width 0.3s;
        }
        
        .exam-question-nav {
            display: grid;
            grid-template-columns: repeat(10, 1fr);
            gap: 5px;
            margin-bottom: 20px;
        }
        
        .exam-nav-btn {
            aspect-ratio: 1;
            border: 1px solid var(--light);
            border-radius: 5px;
            background: white;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .exam-nav-btn.answered {
            background: var(--success);
            color: white;
            border-color: var(--success);
        }
        
        .exam-nav-btn.flagged {
            background: var(--warning);
            color: white;
            border-color: var(--warning);
        }
        
        .exam-nav-btn.current {
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(44, 62, 80, 0.2);
        }
        
        /* Â≠¶Áøí„Ç∞„É´„Éº„Éó */
        .group-panel {
            background: white;
            border-radius: 15px;
            padding: 15px;
            margin: 10px;
        }
        
        .group-member {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            border-bottom: 1px solid var(--light);
        }
        
        .group-member:last-child {
            border-bottom: none;
        }
        
        .member-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
        }
        
        .member-info {
            flex: 1;
        }
        
        .member-name {
            font-weight: 600;
            margin-bottom: 2px;
        }
        
        .member-stats {
            font-size: 12px;
            color: var(--gray);
        }
        
        .member-badge {
            padding: 3px 8px;
            background: var(--success);
            color: white;
            border-radius: 12px;
            font-size: 11px;
        }
        
        /* Â≠¶Áøí‰∫àÊ∏¨ */
        .prediction-panel {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-radius: 15px;
            padding: 20px;
            margin: 10px;
        }
        
        .prediction-score {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .prediction-value {
            font-size: 48px;
            font-weight: 700;
            margin-bottom: 5px;
        }
        
        .prediction-label {
            font-size: 14px;
            opacity: 0.9;
        }
        
        .prediction-factors {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
        }
        
        .factor-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .factor-item:last-child {
            margin-bottom: 0;
        }
        
        .factor-name {
            font-size: 13px;
        }
        
        .factor-score {
            display: flex;
            gap: 2px;
        }
        
        .factor-star {
            font-size: 12px;
        }
        
        /* „Éá„Éº„Çø„Ç®„ÇØ„Çπ„Éù„Éº„Éà */
        .export-panel {
            background: white;
            border-radius: 15px;
            padding: 15px;
            margin: 10px;
        }
        
        .export-options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .export-option {
            padding: 15px;
            border: 2px solid var(--light);
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .export-option:hover {
            border-color: var(--primary);
            background: var(--lighter);
        }
        
        .export-option.selected {
            border-color: var(--primary);
            background: rgba(44, 62, 80, 0.05);
        }
        
        .export-icon {
            font-size: 24px;
            margin-bottom: 5px;
        }
        
        .export-label {
            font-size: 13px;
            font-weight: 600;
        }
        
        /* ÈñìÈÅï„ÅÑÂïèÈ°åÈõÜ */
        .mistake-collection {
            background: white;
            border-radius: 15px;
            padding: 15px;
            margin: 10px;
        }
        
        .mistake-filter {
            display: flex;
            gap: 5px;
            margin-bottom: 15px;
            overflow-x: auto;
            scrollbar-width: none;
        }
        
        .mistake-filter::-webkit-scrollbar {
            display: none;
        }
        
        .filter-chip {
            padding: 5px 12px;
            background: var(--light);
            border-radius: 15px;
            font-size: 12px;
            white-space: nowrap;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .filter-chip.active {
            background: var(--primary);
            color: white;
        }
        
        .mistake-list {
            max-height: 400px;
            overflow-y: auto;
        }
        
        .mistake-item {
            padding: 10px;
            border-left: 3px solid var(--danger);
            background: var(--lighter);
            border-radius: 5px;
            margin-bottom: 10px;
        }
        
        .mistake-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 5px;
        }
        
        .mistake-title {
            font-weight: 600;
            font-size: 14px;
        }
        
        .mistake-count {
            padding: 2px 6px;
            background: var(--danger);
            color: white;
            border-radius: 10px;
            font-size: 11px;
        }
        
        .mistake-meta {
            font-size: 12px;
            color: var(--gray);
        }
        
        /* Â≠¶ÁøíÂäπÁéá„Çπ„Ç≥„Ç¢ */
        .efficiency-panel {
            background: white;
            border-radius: 15px;
            padding: 15px;
            margin: 10px;
        }
        
        .efficiency-chart {
            height: 150px;
            position: relative;
            margin-bottom: 15px;
        }
        
        .efficiency-line {
            stroke: var(--primary);
            stroke-width: 2;
            fill: none;
        }
        
        .efficiency-area {
            fill: url(#efficiencyGradient);
            opacity: 0.3;
        }
        
        .efficiency-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }
        
        .efficiency-stat {
            text-align: center;
            padding: 10px;
            background: var(--lighter);
            border-radius: 10px;
        }
        
        .efficiency-stat-value {
            font-size: 18px;
            font-weight: 700;
            color: var(--primary);
        }
        
        .efficiency-stat-label {
            font-size: 11px;
            color: var(--gray);
            margin-top: 3px;
        }
        
        /* „É¢„ÉÅ„Éô„Éº„Ç∑„Éß„É≥Ê©üËÉΩ */
        .motivation-banner {
            background: linear-gradient(135deg, var(--warning), var(--pink));
            color: white;
            border-radius: 15px;
            padding: 15px;
            margin: 10px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .motivation-banner::before {
            content: '‚ú®';
            position: absolute;
            font-size: 60px;
            opacity: 0.1;
            top: -10px;
            right: 20px;
            transform: rotate(15deg);
        }
        
        .motivation-message {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .motivation-submessage {
            font-size: 13px;
            opacity: 0.9;
        }
        
        /* Èõ£ÊòìÂ∫¶ÁÆ°ÁêÜ */
        .difficulty-selector {
            display: flex;
            gap: 5px;
            margin: 10px 0;
        }
        
        .difficulty-btn {
            flex: 1;
            padding: 8px;
            border: 1px solid var(--light);
            background: white;
            border-radius: 8px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s;
        }
        
        .difficulty-btn.easy {
            border-color: var(--success);
            color: var(--success);
        }
        
        .difficulty-btn.medium {
            border-color: var(--warning);
            color: var(--warning);
        }
        
        .difficulty-btn.hard {
            border-color: var(--danger);
            color: var(--danger);
        }
        
        .difficulty-btn.selected {
            color: white;
        }
        
        .difficulty-btn.easy.selected {
            background: var(--success);
        }
        
        .difficulty-btn.medium.selected {
            background: var(--warning);
        }
        
        .difficulty-btn.hard.selected {
            background: var(--danger);
        }
        
        /* „Çø„Ç∞„Ç∑„Çπ„ÉÜ„É† */
        .tag-manager {
            background: white;
            border-radius: 15px;
            padding: 15px;
            margin: 10px;
        }
        
        .tag-input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .tag-input {
            flex: 1;
            padding: 8px;
            border: 1px solid var(--light);
            border-radius: 8px;
            font-size: 14px;
        }
        
        .tag-add-btn {
            padding: 8px 15px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
        }
        
        .tag-cloud {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        
        .tag-item {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 5px 10px;
            background: var(--light);
            border-radius: 15px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .tag-item:hover {
            background: var(--primary);
            color: white;
        }
        
        .tag-count {
            font-size: 11px;
            opacity: 0.7;
        }
        
        .tag-remove {
            cursor: pointer;
            opacity: 0.5;
        }
        
        .tag-remove:hover {
            opacity: 1;
        }
        
        /* „É™„Éû„Ç§„É≥„ÉÄ„ÉºË®≠ÂÆö */
        .reminder-settings {
            background: white;
            border-radius: 15px;
            padding: 15px;
            margin: 10px;
        }
        
        .reminder-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid var(--light);
        }
        
        .reminder-item:last-child {
            border-bottom: none;
        }
        
        .reminder-info {
            flex: 1;
        }
        
        .reminder-time {
            font-weight: 600;
            margin-bottom: 3px;
        }
        
        .reminder-days {
            font-size: 12px;
            color: var(--gray);
        }
        
        .reminder-toggle {
            position: relative;
            width: 50px;
            height: 25px;
            background: var(--light);
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .reminder-toggle.active {
            background: var(--success);
        }
        
        .reminder-toggle-slider {
            position: absolute;
            top: 2px;
            left: 2px;
            width: 21px;
            height: 21px;
            background: white;
            border-radius: 50%;
            transition: all 0.3s;
        }
        
        .reminder-toggle.active .reminder-toggle-slider {
            left: 27px;
        }
        
        /* Ë©≥Á¥∞„É¨„Éù„Éº„Éà */
        .report-container {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin: 10px;
        }
        
        .report-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--light);
        }
        
        .report-title {
            font-size: 20px;
            font-weight: 700;
        }
        
        .report-actions {
            display: flex;
            gap: 10px;
        }
        
        .report-btn {
            padding: 8px 15px;
            border: 1px solid var(--light);
            background: white;
            border-radius: 8px;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.3s;
        }
        
        .report-btn:hover {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }
        
        .report-section {
            margin-bottom: 30px;
        }
        
        .report-section-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--light);
        }
        
        .report-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .report-table th,
        .report-table td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid var(--light);
        }
        
        .report-table th {
            background: var(--lighter);
            font-weight: 600;
            font-size: 13px;
        }
        
        .report-table td {
            font-size: 13px;
        }
        
        /* „Çπ„Éî„Éº„Éâ„É°„Éº„Çø„ÉºÈ¢®„Çπ„Ç≥„Ç¢Ë°®Á§∫ */
        .speedometer {
            width: 200px;
            height: 100px;
            margin: 20px auto;
            position: relative;
        }
        
        .speedometer-arc {
            stroke: var(--light);
            stroke-width: 10;
            fill: none;
        }
        
        .speedometer-progress {
            stroke: url(#speedGradient);
            stroke-width: 10;
            fill: none;
            stroke-linecap: round;
            transition: stroke-dashoffset 1s ease;
        }
        
        .speedometer-needle {
            position: absolute;
            bottom: 0;
            left: 50%;
            width: 2px;
            height: 80px;
            background: var(--danger);
            transform-origin: bottom center;
            transition: transform 1s ease;
        }
        
        .speedometer-value {
            position: absolute;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 24px;
            font-weight: 700;
        }
        
        /* „Ç≥„É≥„ÉÜ„É≥„ÉÑ„Ç®„É™„Ç¢ */
        .content-area {
            flex: 1;
            padding-bottom: 80px;
            overflow-y: auto;
        }
        
        /* „Ç´„Éº„Éâ */
        .card {
            background: white;
            border-radius: 15px;
            padding: 15px;
            margin: 10px;
            box-shadow: var(--shadow);
        }
        
        .card-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--light);
        }
        
        .card-icon {
            font-size: 20px;
        }
        
        .card-title {
            font-size: 16px;
            font-weight: 700;
            color: var(--dark);
        }
        
        /* ÈöéÂ±§„É™„Çπ„ÉàË°®Á§∫ */
        .hierarchy-list {
            padding: 10px;
        }
        
        .hierarchy-item {
            border: 1px solid var(--light);
            border-radius: 8px;
            margin-bottom: 8px;
            overflow: hidden;
        }
        
        .hierarchy-row {
            display: flex;
            align-items: center;
            padding: 12px;
            background: white;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .hierarchy-row:hover {
            background: var(--lighter);
        }
        
        .hierarchy-toggle {
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 8px;
            font-size: 12px;
            transition: transform 0.3s;
        }
        
        .hierarchy-toggle.expanded {
            transform: rotate(90deg);
        }
        
        .hierarchy-icon {
            margin-right: 8px;
            font-size: 16px;
        }
        
        .hierarchy-label {
            flex: 1;
            font-weight: 500;
        }
        
        .hierarchy-meta {
            margin-left: auto;
            margin-right: 10px;
            font-size: 12px;
            color: var(--gray);
        }
        
        .hierarchy-actions {
            display: flex;
            gap: 5px;
        }
        
        .hierarchy-action {
            padding: 4px;
            background: transparent;
            color: var(--gray-light);
            border: none;
            border-radius: 4px;
            font-size: 14px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            width: 28px;
            height: 28px;
        }
        
        .hierarchy-action:hover {
            color: var(--gray);
            background: rgba(107, 114, 128, 0.1);
        }
        
        .hierarchy-action.edit:hover {
            color: var(--primary);
            background: rgba(44, 62, 80, 0.1);
        }
        
        .hierarchy-action.delete:hover {
            color: var(--danger);
            background: rgba(239, 68, 68, 0.1);
        }
        
        .hierarchy-children {
            display: none;
            background: var(--lighter);
            padding: 8px;
        }
        
        .hierarchy-children.expanded {
            display: block;
        }
        
        /* „Åù„ÅÆ‰ªñÊó¢Â≠ò„Çπ„Çø„Ç§„É´ÁúÅÁï•... */
        
        /* „É¨„Çπ„Éù„É≥„Ç∑„ÉñÂØæÂøú */
        @media (max-width: 768px) {
            .goal-grid {
                grid-template-columns: 1fr;
            }
            
            .export-options {
                grid-template-columns: 1fr;
            }
            
            .efficiency-stats {
                grid-template-columns: 1fr;
            }
            
            .exam-question-nav {
                grid-template-columns: repeat(5, 1fr);
            }
        }
        
        /* „ÉÄ„Éº„ÇØ„É¢„Éº„ÉâÂØæÂøúÊ∫ñÂÇô */
        @media (prefers-color-scheme: dark) {
            /* Â∞ÜÊù•ÁöÑ„Å´„ÉÄ„Éº„ÇØ„É¢„Éº„ÉâÂØæÂøú */
        }
        
        /* „Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ËøΩÂä† */
        .fade-in {
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .slide-in {
            animation: slideIn 0.3s ease;
        }
        
        @keyframes slideIn {
            from { transform: translateX(-100%); }
            to { transform: translateX(0); }
        }
        
        /* „É≠„Éº„Éá„Ç£„É≥„Ç∞„Çπ„Éî„Éä„Éº */
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid var(--light);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- „Éò„ÉÉ„ÉÄ„Éº -->
    <header class="app-header">
        <div class="dashboard-widget">
            <button class="widget-btn" onclick="toggleTimer()">‚è±Ô∏è</button>
            <button class="widget-btn" onclick="toggleDarkMode()">üåô</button>
            <button class="widget-btn" onclick="showNotifications()">üîî</button>
        </div>
        <div class="app-logo">
            <span class="app-logo-icon">üìö</span>
            <span class="app-title">Â≠¶Áøí„Éà„É©„ÉÉ„Ç´„Éº Pro</span>
        </div>
        <div class="app-subtitle">Ë°åÊîøÊõ∏Â£´Ë©¶È®ìÂØæÁ≠ñ v3.0 Premium</div>
    </header>
    
    <!-- „Çø„Ç§„Éû„ÉºË°®Á§∫ -->
    <div id="timerDisplay" class="timer-display">
        <div class="timer-time" id="timerTime">00:00:00</div>
        <div class="timer-controls">
            <button class="timer-btn" onclick="startTimer()">ÈñãÂßã</button>
            <button class="timer-btn pause" onclick="pauseTimer()">‰∏ÄÊôÇÂÅúÊ≠¢</button>
            <button class="timer-btn stop" onclick="stopTimer()">ÂÅúÊ≠¢</button>
        </div>
        <div class="pomodoro-settings">
            <div class="pomodoro-status" id="pomodoroStatus">‰ΩúÊ•≠ÊôÇÈñì: 25ÂàÜ</div>
            <div class="pomodoro-progress" id="pomodoroProgress">
                <div class="pomodoro-dot"></div>
                <div class="pomodoro-dot"></div>
                <div class="pomodoro-dot"></div>
                <div class="pomodoro-dot"></div>
            </div>
        </div>
    </div>
    
    <!-- „É°„Ç§„É≥„Çø„ÉñÔºàÊã°ÂºµÁâàÔºâ -->
    <div class="main-tabs">
        <button class="main-tab active" onclick="switchMainTab('dashboard', event)">„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ</button>
        <button class="main-tab" onclick="switchMainTab('record', event)">Ë®òÈå≤ÂÖ•Âäõ</button>
        <button class="main-tab" onclick="switchMainTab('analysis', event)">Ë©≥Á¥∞ÂàÜÊûê</button>
        <button class="main-tab" onclick="switchMainTab('exam', event)">Ê®°Êì¨Ë©¶È®ì</button>
        <button class="main-tab" onclick="switchMainTab('review', event)">Âæ©ÁøíÁÆ°ÁêÜ</button>
        <button class="main-tab" onclick="switchMainTab('group', event)">Â≠¶Áøí„Ç∞„É´„Éº„Éó</button>
    </div>
    
    <!-- „Ç≥„É≥„ÉÜ„É≥„ÉÑ„Ç®„É™„Ç¢ -->
    <div class="content-area">
        <!-- „ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ„Çø„Éñ -->
        <div id="dashboard-tab" class="tab-content active">
            <!-- „É¢„ÉÅ„Éô„Éº„Ç∑„Éß„É≥„Éê„Éä„Éº -->
            <div class="motivation-banner" id="motivationBanner">
                <div class="motivation-message">‰ªäÊó•„ÇÇÈ†ëÂºµ„Çä„Åæ„Åó„Çá„ÅÜÔºÅ</div>
                <div class="motivation-submessage">ÈÄ£Á∂öÂ≠¶Áøí <span id="streakDays">0</span>Êó•ÁõÆ</div>
            </div>
            
            <!-- AIÊèêÊ°à„Éë„Éç„É´ -->
            <div class="ai-suggestion-panel">
                <div class="ai-suggestion-title">
                    <span class="ai-suggestion-icon">ü§ñ</span>
                    AIÂ≠¶Áøí„Ç¢„Éâ„Éê„Ç§„Ç∂„Éº
                </div>
                <div class="ai-suggestion-content" id="aiSuggestion">
                    ÂàÜÊûê‰∏≠...
                </div>
                <div class="ai-suggestion-action">
                    <button class="ai-action-btn" onclick="acceptAISuggestion()">ÊèêÊ°à„ÇíÂÆüË°å</button>
                    <button class="ai-action-btn" onclick="refreshAISuggestion()">Âà•„ÅÆÊèêÊ°à</button>
                </div>
            </div>
            
            <!-- ÁõÆÊ®ôË®≠ÂÆö„Éë„Éç„É´ -->
            <div class="goal-panel">
                <div class="goal-title">üìä ‰ªäÊó•„ÅÆÁõÆÊ®ô</div>
                <div class="goal-grid">
                    <div class="goal-item">
                        <div class="goal-value" id="dailyGoalValue">0/50</div>
                        <div class="goal-label">ÂïèÈ°åÊï∞</div>
                        <div class="goal-progress">
                            <div class="goal-progress-fill" id="dailyGoalProgress" style="width: 0%;"></div>
                        </div>
                    </div>
                    <div class="goal-item">
                        <div class="goal-value" id="timeGoalValue">0/120</div>
                        <div class="goal-label">Â≠¶ÁøíÊôÇÈñì(ÂàÜ)</div>
                        <div class="goal-progress">
                            <div class="goal-progress-fill" id="timeGoalProgress" style="width: 0%;"></div>
                        </div>
                    </div>
                    <div class="goal-item">
                        <div class="goal-value" id="accuracyGoalValue">0%</div>
                        <div class="goal-label">Ê≠£Á≠îÁéáÁõÆÊ®ô</div>
                        <div class="goal-progress">
                            <div class="goal-progress-fill" id="accuracyGoalProgress" style="width: 0%;"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Â≠¶Áøí‰∫àÊ∏¨„Éë„Éç„É´ -->
            <div class="prediction-panel">
                <div class="prediction-score">
                    <div class="prediction-value" id="predictionScore">72%</div>
                    <div class="prediction-label">ÂêàÊ†ºÂèØËÉΩÊÄß</div>
                </div>
                <div class="prediction-factors">
                    <div class="factor-item">
                        <span class="factor-name">Â≠¶ÁøíÁ∂ôÁ∂öÊÄß</span>
                        <span class="factor-score" id="continuityScore">
                            <span class="factor-star">‚≠ê</span>
                            <span class="factor-star">‚≠ê</span>
                            <span class="factor-star">‚≠ê</span>
                        </span>
                    </div>
                    <div class="factor-item">
                        <span class="factor-name">ÁêÜËß£Â∫¶</span>
                        <span class="factor-score" id="understandingScore">
                            <span class="factor-star">‚≠ê</span>
                            <span class="factor-star">‚≠ê</span>
                            <span class="factor-star">‚≠ê</span>
                        </span>
                    </div>
                    <div class="factor-item">
                        <span class="factor-name">Âº±ÁÇπÂÖãÊúç</span>
                        <span class="factor-score" id="weaknessScore">
                            <span class="factor-star">‚≠ê</span>
                            <span class="factor-star">‚≠ê</span>
                        </span>
                    </div>
                </div>
            </div>
            
            <!-- „Ç´„É¨„É≥„ÉÄ„Éº„Éì„É•„Éº -->
            <div class="calendar-container">
                <div class="calendar-header">
                    <h3 id="calendarMonth">2024Âπ¥1Êúà</h3>
                    <div class="calendar-nav">
                        <button class="calendar-nav-btn" onclick="changeCalendarMonth(-1)">Ôºú</button>
                        <button class="calendar-nav-btn" onclick="changeCalendarMonth(1)">Ôºû</button>
                    </div>
                </div>
                <div class="calendar-grid" id="calendarGrid"></div>
            </div>
            
            <!-- Â≠¶ÁøíÂäπÁéá„Éë„Éç„É´ -->
            <div class="efficiency-panel">
                <h3>Â≠¶ÁøíÂäπÁéá„Çπ„Ç≥„Ç¢</h3>
                <div class="efficiency-chart">
                    <svg width="100%" height="100%">
                        <defs>
                            <linearGradient id="efficiencyGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                                <stop offset="0%" style="stop-color:var(--primary);stop-opacity:0.8" />
                                <stop offset="100%" style="stop-color:var(--primary);stop-opacity:0.1" />
                            </linearGradient>
                        </defs>
                        <polyline class="efficiency-line" id="efficiencyLine" points=""></polyline>
                        <polygon class="efficiency-area" id="efficiencyArea" points=""></polygon>
                    </svg>
                </div>
                <div class="efficiency-stats">
                    <div class="efficiency-stat">
                        <div class="efficiency-stat-value" id="avgSpeed">12</div>
                        <div class="efficiency-stat-label">Âïè/ÊôÇÈñì</div>
                    </div>
                    <div class="efficiency-stat">
                        <div class="efficiency-stat-value" id="focusScore">85%</div>
                        <div class="efficiency-stat-label">ÈõÜ‰∏≠Â∫¶</div>
                    </div>
                    <div class="efficiency-stat">
                        <div class="efficiency-stat-value" id="retentionRate">78%</div>
                        <div class="efficiency-stat-label">ÂÆöÁùÄÁéá</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Ë®òÈå≤ÂÖ•Âäõ„Çø„Éñ -->
        <div id="record-tab" class="tab-content">
            <!-- Êó¢Â≠ò„ÅÆË®òÈå≤ÂÖ•Âäõ„Ç≥„É≥„ÉÜ„É≥„ÉÑ -->
            <div id="bookCardsContainer"></div>
            <div class="breadcrumb" id="breadcrumb" style="display: none;"></div>
            <div id="recordHierarchyContainer" style="display: none;"></div>
            
            <!-- Êã°ÂºµÁâàÂïèÈ°åÂÖ•Âäõ -->
            <div class="card" id="questionSection" style="display: none;">
                <div class="card-header">
                    <span class="card-icon">‚úçÔ∏è</span>
                    <span class="card-title">ÂïèÈ°åÂà•Ê≠£Ë™§ÂÖ•Âäõ</span>
                </div>
                
                <!-- Èõ£ÊòìÂ∫¶ÈÅ∏Êäû -->
                <div class="difficulty-selector">
                    <button class="difficulty-btn easy" onclick="setDifficulty('easy', this)">Á∞°Âçò</button>
                    <button class="difficulty-btn medium" onclick="setDifficulty('medium', this)">ÊôÆÈÄö</button>
                    <button class="difficulty-btn hard" onclick="setDifficulty('hard', this)">Èõ£„Åó„ÅÑ</button>
                </div>
                
                <!-- „Éé„Éº„ÉàÊ©üËÉΩ -->
                <div class="note-panel">
                    <div class="note-toolbar">
                        <button class="note-tool-btn" onclick="addNoteTag('ÈáçË¶Å')">ÈáçË¶Å</button>
                        <button class="note-tool-btn" onclick="addNoteTag('Âæ©ÁøíÂøÖË¶Å')">Âæ©ÁøíÂøÖË¶Å</button>
                        <button class="note-tool-btn" onclick="addNoteTag('ÁêÜËß£Ê∏à„Åø')">ÁêÜËß£Ê∏à„Åø</button>
                        <button class="note-tool-btn" onclick="addNoteTag('È†ªÂá∫')">È†ªÂá∫</button>
                    </div>
                    <textarea class="note-editor" id="questionNote" placeholder="„É°„É¢„ÇíÂÖ•Âäõ..."></textarea>
                    <div class="note-tags" id="noteTags"></div>
                </div>
                
                <div class="action-buttons">
                    <button class="action-btn correct" onclick="markCorrect()">
                        <span>‚≠ï</span>
                        <span>Ê≠£Ëß£</span>
                    </button>
                    <button class="action-btn wrong" onclick="markWrong()">
                        <span>‚ùå</span>
                        <span>‰∏çÊ≠£Ëß£</span>
                    </button>
                    <button class="action-btn bookmark" id="bookmarkBtn" onclick="toggleBookmarkMode()">
                        <span>‚≠ê</span>
                        <span>„Éû„Éº„ÇØ</span>
                    </button>
                </div>
                
                <div class="question-grid" id="questionGrid"></div>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="totalCount">0</div>
                        <div class="stat-label">Ëß£Á≠îÊï∞</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="correctCount">0</div>
                        <div class="stat-label">Ê≠£Ëß£Êï∞</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="wrongCount">0</div>
                        <div class="stat-label">‰∏çÊ≠£Ëß£Êï∞</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="correctRate">0%</div>
                        <div class="stat-label">Ê≠£Á≠îÁéá</div>
                    </div>
                </div>
                
                <button class="save-button" onclick="saveRecord()">Â≠¶ÁøíË®òÈå≤„Çí‰øùÂ≠ò</button>
            </div>
        </div>
        
        <!-- Ë©≥Á¥∞ÂàÜÊûê„Çø„Éñ -->
        <div id="analysis-tab" class="tab-content">
            <!-- Ë©≥Á¥∞„É¨„Éù„Éº„Éà -->
            <div class="report-container">
                <div class="report-header">
                    <div class="report-title">üìä Ë©≥Á¥∞ÂàÜÊûê„É¨„Éù„Éº„Éà</div>
                    <div class="report-actions">
                        <button class="report-btn" onclick="exportReport('pdf')">PDFÂá∫Âäõ</button>
                        <button class="report-btn" onclick="exportReport('csv')">CSVÂá∫Âäõ</button>
                        <button class="report-btn" onclick="shareReport()">ÂÖ±Êúâ</button>
                    </div>
                </div>
                
                <div class="report-section">
                    <div class="report-section-title">ÁßëÁõÆÂà•„Éë„Éï„Ç©„Éº„Éû„É≥„Çπ</div>
                    <table class="report-table" id="subjectReportTable">
                        <thead>
                            <tr>
                                <th>ÁßëÁõÆ</th>
                                <th>Ëß£Á≠îÊï∞</th>
                                <th>Ê≠£Á≠îÁéá</th>
                                <th>ÂâçÈÄ±ÊØî</th>
                                <th>Êé®Â•®ÂÑ™ÂÖàÂ∫¶</th>
                            </tr>
                        </thead>
                        <tbody id="subjectReportBody"></tbody>
                    </table>
                </div>
                
                <div class="report-section">
                    <div class="report-section-title">ÊôÇÈñìÂ∏ØÂà•ÂäπÁéá</div>
                    <div id="timeEfficiencyChart"></div>
                </div>
                
                <div class="report-section">
                    <div class="report-section-title">‰∫àÊ∏¨„Çπ„Ç≥„Ç¢Êé®Áßª</div>
                    <div class="speedometer">
                        <svg width="200" height="100">
                            <defs>
                                <linearGradient id="speedGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                                    <stop offset="0%" style="stop-color:var(--danger);stop-opacity:1" />
                                    <stop offset="50%" style="stop-color:var(--warning);stop-opacity:1" />
                                    <stop offset="100%" style="stop-color:var(--success);stop-opacity:1" />
                                </linearGradient>
                            </defs>
                            <path class="speedometer-arc" d="M 20 80 A 70 70 0 0 1 180 80" />
                            <path class="speedometer-progress" d="M 20 80 A 70 70 0 0 1 180 80" 
                                  stroke-dasharray="220" stroke-dashoffset="110" />
                        </svg>
                        <div class="speedometer-needle" id="speedometerNeedle"></div>
                        <div class="speedometer-value" id="speedometerValue">75%</div>
                    </div>
                </div>
            </div>
            
            <!-- ÈñìÈÅï„ÅÑÂïèÈ°åÈõÜ -->
            <div class="mistake-collection">
                <h3>‚ùå ÈñìÈÅï„ÅÑÂïèÈ°åÈõÜ</h3>
                <div class="mistake-filter">
                    <div class="filter-chip active" onclick="filterMistakes('all', this)">„Åô„Åπ„Å¶</div>
                    <div class="filter-chip" onclick="filterMistakes('recent', this)">ÊúÄËøë</div>
                    <div class="filter-chip" onclick="filterMistakes('frequent', this)">È†ªÂá∫</div>
                    <div class="filter-chip" onclick="filterMistakes('bookmarked', this)">„Éû„Éº„ÇØÊ∏à„Åø</div>
                </div>
                <div class="mistake-list" id="mistakeList"></div>
            </div>
        </div>
        
        <!-- Ê®°Êì¨Ë©¶È®ì„Çø„Éñ -->
        <div id="exam-tab" class="tab-content">
            <div class="exam-mode-container">
                <div class="exam-header">
                    <div>
                        <h3>üìù Ê®°Êì¨Ë©¶È®ì„É¢„Éº„Éâ</h3>
                        <p style="font-size: 13px; color: var(--gray); margin-top: 5px;">Êú¨Áï™ÂΩ¢Âºè 60Âïè 180ÂàÜ</p>
                    </div>
                    <div class="exam-timer">
                        <span class="exam-timer-icon">‚è∞</span>
                        <span id="examTimer">03:00:00</span>
                    </div>
                </div>
                
                <div class="exam-progress-bar">
                    <div class="exam-progress-fill" id="examProgress" style="width: 0%;"></div>
                </div>
                
                <div class="exam-question-nav" id="examQuestionNav"></div>
                
                <div class="card">
                    <div id="examQuestionContent">
                        <p style="text-align: center; color: var(--gray);">
                            Ë©¶È®ì„ÇíÈñãÂßã„Åô„Çã„Å´„ÅØ‰∏ã„ÅÆ„Éú„Çø„É≥„Çí„ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶„Åè„Å†„Åï„ÅÑ
                        </p>
                    </div>
                </div>
                
                <div class="action-buttons">
                    <button class="action-btn correct" onclick="startExam()">Ë©¶È®ìÈñãÂßã</button>
                    <button class="action-btn wrong" onclick="endExam()" style="display: none;" id="endExamBtn">Ë©¶È®ìÁµÇ‰∫Ü</button>
                </div>
            </div>
        </div>
        
        <!-- Âæ©ÁøíÁÆ°ÁêÜ„Çø„Éñ -->
        <div id="review-tab" class="tab-content">
            <!-- Âæ©Áøí„Çπ„Ç±„Ç∏„É•„Éº„É´ -->
            <div class="review-schedule">
                <h3>üìÖ Âæ©Áøí„Çπ„Ç±„Ç∏„É•„Éº„É´Ôºà„Ç®„Éì„É≥„Ç∞„Éè„Ç¶„Çπ„ÅÆÂøòÂç¥Êõ≤Á∑öÂØæÂøúÔºâ</h3>
                <div class="review-timeline" id="reviewTimeline">
                    <div class="review-item urgent">
                        <div class="review-date">‰ªäÊó•</div>
                        <div class="review-content">Ê∞ëÊ≥ï - Á∑èÂâá - Ê®©Âà©ËÉΩÂäõ</div>
                        <div class="review-stats">ÂâçÂõûÊ≠£Á≠îÁéá: 60% | Âæ©ÁøíÂõûÊï∞: 2Âõû</div>
                    </div>
                    <div class="review-item">
                        <div class="review-date">ÊòéÊó•</div>
                        <div class="review-content">Ë°åÊîøÊ≥ï - Ë°åÊîø‰∏ª‰Ωì</div>
                        <div class="review-stats">ÂâçÂõûÊ≠£Á≠îÁéá: 75% | Âæ©ÁøíÂõûÊï∞: 1Âõû</div>
                    </div>
                    <div class="review-item">
                        <div class="review-date">3Êó•Âæå</div>
                        <div class="review-content">ÊÜ≤Ê≥ï - Âü∫Êú¨ÁöÑ‰∫∫Ê®©</div>
                        <div class="review-stats">ÂâçÂõûÊ≠£Á≠îÁéá: 80% | Âæ©ÁøíÂõûÊï∞: 3Âõû</div>
                    </div>
                </div>
            </div>
            
            <!-- „Çø„Ç∞ÁÆ°ÁêÜ -->
            <div class="tag-manager">
                <h3>üè∑Ô∏è „Çø„Ç∞ÁÆ°ÁêÜ</h3>
                <div class="tag-input-group">
                    <input type="text" class="tag-input" id="newTagInput" placeholder="Êñ∞„Åó„ÅÑ„Çø„Ç∞„ÇíÂÖ•Âäõ">
                    <button class="tag-add-btn" onclick="addNewTag()">ËøΩÂä†</button>
                </div>
                <div class="tag-cloud" id="tagCloud"></div>
            </div>
            
            <!-- „É™„Éû„Ç§„É≥„ÉÄ„ÉºË®≠ÂÆö -->
            <div class="reminder-settings">
                <h3>‚è∞ Â≠¶Áøí„É™„Éû„Ç§„É≥„ÉÄ„Éº</h3>
                <div class="reminder-item">
                    <div class="reminder-info">
                        <div class="reminder-time">Êúù„ÅÆÂ≠¶Áøí 7:00</div>
                        <div class="reminder-days">Êúà„ÉªÁÅ´„ÉªÊ∞¥„ÉªÊú®„ÉªÈáë</div>
                    </div>
                    <div class="reminder-toggle" onclick="toggleReminder(this)">
                        <div class="reminder-toggle-slider"></div>
                    </div>
                </div>
                <div class="reminder-item">
                    <div class="reminder-info">
                        <div class="reminder-time">Êòº„ÅÆÂæ©Áøí 12:30</div>
                        <div class="reminder-days">ÊØéÊó•</div>
                    </div>
                    <div class="reminder-toggle" onclick="toggleReminder(this)">
                        <div class="reminder-toggle-slider"></div>
                    </div>
                </div>
                <div class="reminder-item">
                    <div class="reminder-info">
                        <div class="reminder-time">Â§ú„ÅÆÂ≠¶Áøí 20:00</div>
                        <div class="reminder-days">Êúà„ÉªÊ∞¥„ÉªÈáë„ÉªÂúü„ÉªÊó•</div>
                    </div>
                    <div class="reminder-toggle active" onclick="toggleReminder(this)">
                        <div class="reminder-toggle-slider"></div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Â≠¶Áøí„Ç∞„É´„Éº„Éó„Çø„Éñ -->
        <div id="group-tab" class="tab-content">
            <div class="group-panel">
                <h3>üë• Â≠¶Áøí„Ç∞„É´„Éº„Éó - Ë°åÊîøÊõ∏Â£´Ë©¶È®ìÂØæÁ≠ñ</h3>
                <div class="group-member">
                    <div class="member-avatar">A</div>
                    <div class="member-info">
                        <div class="member-name">„ÅÇ„Å™„Åü</div>
                        <div class="member-stats">‰ªäÈÄ±: 350Âïè | Ê≠£Á≠îÁéá: 78%</div>
                    </div>
                    <div class="member-badge">1‰Ωç</div>
                </div>
                <div class="group-member">
                    <div class="member-avatar">B</div>
                    <div class="member-info">
                        <div class="member-name">Áî∞‰∏≠„Åï„Çì</div>
                        <div class="member-stats">‰ªäÈÄ±: 320Âïè | Ê≠£Á≠îÁéá: 82%</div>
                    </div>
                    <div class="member-badge">2‰Ωç</div>
                </div>
                <div class="group-member">
                    <div class="member-avatar">C</div>
                    <div class="member-info">
                        <div class="member-name">‰ΩêËó§„Åï„Çì</div>
                        <div class="member-stats">‰ªäÈÄ±: 280Âïè | Ê≠£Á≠îÁéá: 75%</div>
                    </div>
                    <div class="member-badge">3‰Ωç</div>
                </div>
            </div>
            
            <!-- „Éá„Éº„Çø„Ç®„ÇØ„Çπ„Éù„Éº„Éà -->
            <div class="export-panel">
                <h3>üíæ „Éá„Éº„Çø„Ç®„ÇØ„Çπ„Éù„Éº„Éà/„Ç§„É≥„Éù„Éº„Éà</h3>
                <div class="export-options">
                    <div class="export-option" onclick="exportData('json')">
                        <div class="export-icon">üìÑ</div>
                        <div class="export-label">JSONÂΩ¢Âºè</div>
                    </div>
                    <div class="export-option" onclick="exportData('csv')">
                        <div class="export-icon">üìä</div>
                        <div class="export-label">CSVÂΩ¢Âºè</div>
                    </div>
                    <div class="export-option" onclick="exportData('pdf')">
                        <div class="export-icon">üìë</div>
                        <div class="export-label">PDF„É¨„Éù„Éº„Éà</div>
                    </div>
                    <div class="export-option" onclick="importData()">
                        <div class="export-icon">üì•</div>
                        <div class="export-label">„Ç§„É≥„Éù„Éº„Éà</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- „Éï„ÉÉ„Çø„Éº„Çø„Éñ -->
    <div class="footer-tabs">
        <button class="footer-tab active" onclick="switchFooterTab('register', event)">
            <span class="footer-tab-icon">üìù</span>
            <span class="footer-tab-label">ÁôªÈå≤</span>
        </button>
        <button class="footer-tab" onclick="switchFooterTab('history', event)">
            <span class="footer-tab-icon">üìÖ</span>
            <span class="footer-tab-label">Â±•Ê≠¥</span>
        </button>
        <button class="footer-tab" onclick="switchFooterTab('results', event)">
            <span class="footer-tab-icon">üèÜ</span>
            <span class="footer-tab-label">ÂÆüÁ∏æ</span>
        </button>
        <button class="footer-tab" onclick="switchFooterTab('settings', event)">
            <span class="footer-tab-icon">‚öôÔ∏è</span>
            <span class="footer-tab-label">Ë®≠ÂÆö</span>
        </button>
    </div>
    
    <!-- „É¢„Éº„ÉÄ„É´Á≠â„ÅØÊó¢Â≠ò„ÅÆ„Åæ„Åæ -->
    <div id="footerModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">„Çø„Ç§„Éà„É´</h3>
                <button class="modal-close" onclick="closeFooterModal()">√ó</button>
            </div>
            <div id="modalBody"></div>
        </div>
        <div class="modal-footer">
            <button class="modal-close-bottom" onclick="closeFooterModal()">Èñâ„Åò„Çã</button>
        </div>
    </div>
    
    <script>
        // „Ç∞„É≠„Éº„Éê„É´Â§âÊï∞
        let books = {};
        let currentBook = null;
        let currentPath = [];
        let questionStates = {};
        let allRecords = [];
        let bookmarkMode = false;
        let expandedNodes = new Set();
        let savedQuestionStates = {};
        let selectedBookCard = null;
        let radarChartMode = 'subject';
        
        // Êñ∞Ê©üËÉΩÁî®Â§âÊï∞
        let timerInterval = null;
        let timerSeconds = 0;
        let pomodoroCount = 0;
        let currentCalendarMonth = new Date();
        let examMode = false;
        let examQuestions = [];
        let examCurrentQuestion = 0;
        let examAnswers = {};
        let examTimerInterval = null;
        let examTimeLeft = 10800; // 180ÂàÜ
        let dailyGoals = { questions: 50, time: 120, accuracy: 80 };
        let dailyProgress = { questions: 0, time: 0, accuracy: 0 };
        let noteTags = new Set();
        let questionNotes = {};
        let questionDifficulty = {};
        let mistakeFilter = 'all';
        let reminders = [];
        let studyGroups = [];
        let efficiencyData = [];
        let motivationMessages = [
            "Á¥†Êô¥„Çâ„Åó„ÅÑÈÄ≤Êçó„Åß„ÅôÔºÅ„Åì„ÅÆË™øÂ≠ê„ÅßÁ∂ö„Åë„Åæ„Åó„Çá„ÅÜÔºÅ",
            "‰ªäÊó•„ÇÇ‰∏ÄÊ≠©ÂâçÈÄ≤„Åó„Åæ„Åó„ÅüÔºÅ",
            "Á∂ôÁ∂ö„ÅØÂäõ„Å™„ÇäÔºÅÈ†ëÂºµ„Å£„Å¶„ÅÑ„Åæ„ÅôÔºÅ",
            "ÁõÆÊ®ôÈÅîÊàê„Åæ„Åß„ÅÇ„Å®Â∞ë„ÅóÔºÅ",
            "ÁùÄÂÆü„Å´ÊàêÈï∑„Åó„Å¶„ÅÑ„Åæ„ÅôÔºÅ"
        ];
        
        // ÂàùÊúüÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });
        
        function initializeApp() {
            loadBooksFromStorage();
            initializeSampleData();
            renderBookCards();
            loadAllRecords();
            loadSavedQuestionStates();
            loadDailyProgress();
            updateDashboard();
            generateCalendar();
            updateAISuggestion();
            updateMotivationBanner();
            updateReviewSchedule();
            updateTagCloud();
            updateMistakeList();
            generateExamQuestionNav();
            updateEfficiencyChart();
            updateSubjectReport();
        }
        
        // „Çø„Ç§„Éû„ÉºÊ©üËÉΩ
        function toggleTimer() {
            const display = document.getElementById('timerDisplay');
            display.classList.toggle('active');
        }
        
        function startTimer() {
            if (timerInterval) return;
            
            timerInterval = setInterval(() => {
                timerSeconds++;
                updateTimerDisplay();
                
                // „Éù„É¢„Éâ„Éº„É≠„Çø„Ç§„Éû„ÉºÂá¶ÁêÜ
                if (timerSeconds % 1500 === 0) { // 25ÂàÜ
                    pomodoroCount++;
                    updatePomodoroDisplay();
                    showNotification('„Éù„É¢„Éâ„Éº„É≠ÂÆå‰∫ÜÔºÅ', '5ÂàÜÈñì„ÅÆ‰ºëÊÜ©„ÇíÂèñ„Çä„Åæ„Åó„Çá„ÅÜ');
                }
            }, 1000);
            
            dailyProgress.time++;
            saveDailyProgress();
        }
        
        function pauseTimer() {
            clearInterval(timerInterval);
            timerInterval = null;
        }
        
        function stopTimer() {
            clearInterval(timerInterval);
            timerInterval = null;
            timerSeconds = 0;
            updateTimerDisplay();
        }
        
        function updateTimerDisplay() {
            const hours = Math.floor(timerSeconds / 3600);
            const minutes = Math.floor((timerSeconds % 3600) / 60);
            const seconds = timerSeconds % 60;
            
            document.getElementById('timerTime').textContent = 
                `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
        }
        
        function updatePomodoroDisplay() {
            const dots = document.querySelectorAll('.pomodoro-dot');
            dots.forEach((dot, index) => {
                if (index < pomodoroCount % 4) {
                    dot.classList.add('completed');
                } else if (index === pomodoroCount % 4) {
                    dot.classList.add('current');
                } else {
                    dot.classList.remove('completed', 'current');
                }
            });
        }
        
        // „Ç´„É¨„É≥„ÉÄ„ÉºÊ©üËÉΩ
        function generateCalendar() {
            const grid = document.getElementById('calendarGrid');
            if (!grid) return;
            
            const year = currentCalendarMonth.getFullYear();
            const month = currentCalendarMonth.getMonth();
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const startDate = new Date(firstDay);
            startDate.setDate(startDate.getDate() - firstDay.getDay());
            
            document.getElementById('calendarMonth').textContent = 
                `${year}Âπ¥${month + 1}Êúà`;
            
            let html = '';
            const dayHeaders = ['Êó•', 'Êúà', 'ÁÅ´', 'Ê∞¥', 'Êú®', 'Èáë', 'Âúü'];
            dayHeaders.forEach(day => {
                html += `<div class="calendar-day-header">${day}</div>`;
            });
            
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            for (let i = 0; i < 42; i++) {
                const date = new Date(startDate);
                date.setDate(startDate.getDate() + i);
                
                const isCurrentMonth = date.getMonth() === month;
                const isToday = date.getTime() === today.getTime();
                const hasData = checkDateHasData(date);
                
                let classes = 'calendar-day';
                if (!isCurrentMonth) classes += ' other-month';
                if (isToday) classes += ' today';
                if (hasData) classes += ' has-data';
                
                const dayData = getDateStudyData(date);
                
                html += `
                    <div class="${classes}" onclick="showDateDetails('${date.toISOString()}')">
                        <div class="calendar-day-number">${date.getDate()}</div>
                        ${hasData ? `
                            <div class="calendar-day-stats">${dayData.count}Âïè</div>
                            <div class="calendar-day-indicator"></div>
                        ` : ''}
                    </div>
                `;
            }
            
            grid.innerHTML = html;
        }
        
        function changeCalendarMonth(direction) {
            currentCalendarMonth.setMonth(currentCalendarMonth.getMonth() + direction);
            generateCalendar();
        }
        
        function checkDateHasData(date) {
            const dateStr = date.toDateString();
            return allRecords.some(record => 
                new Date(record.timestamp).toDateString() === dateStr
            );
        }
        
        function getDateStudyData(date) {
            const dateStr = date.toDateString();
            let count = 0;
            let correct = 0;
            
            allRecords.forEach(record => {
                if (new Date(record.timestamp).toDateString() === dateStr) {
                    count += record.stats.total || 0;
                    correct += record.stats.correct || 0;
                }
            });
            
            return { count, correct };
        }
        
        // AIÊèêÊ°àÊ©üËÉΩ
        function updateAISuggestion() {
            const suggestions = [
                {
                    text: "Ê∞ëÊ≥ï„ÅÆÊ≠£Á≠îÁéá„Åå‰Ωé‰∏ã„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇÂü∫Á§éÂïèÈ°å„Åã„ÇâÂæ©Áøí„Åô„Çã„Åì„Å®„Çí„ÅäÂãß„ÇÅ„Åó„Åæ„Åô„ÄÇ",
                    action: () => focusOnSubject('Ê∞ëÊ≥ï')
                },
                {
                    text: "Ë°åÊîøÊ≥ï„ÅØÂ•ΩË™ø„Åß„ÅôÔºÅ„Çà„ÇäÈõ£„Åó„ÅÑÂïèÈ°å„Å´„ÉÅ„É£„É¨„É≥„Ç∏„Åó„Å¶„Åø„Åæ„Åó„Çá„ÅÜ„ÄÇ",
                    action: () => increaseDifficulty('Ë°åÊîøÊ≥ï')
                },
                {
                    text: "ÊØéÊó•„ÅÆÂ≠¶ÁøíÊôÇÈñì„Çí15ÂàÜÂ¢ó„ÇÑ„Åô„Å®„ÄÅÂêàÊ†ºÂèØËÉΩÊÄß„Åå10%Âêë‰∏ä„Åó„Åæ„Åô„ÄÇ",
                    action: () => updateDailyGoals(65, 135, 80)
                },
                {
                    text: "ÊÜ≤Ê≥ï„ÅÆÈ†ªÂá∫ÂïèÈ°å„ÇíÈáçÁÇπÁöÑ„Å´Â≠¶Áøí„Åô„Çã„Åì„Å®„ÅßÂäπÁéá„Åå‰∏ä„Åå„Çä„Åæ„Åô„ÄÇ",
                    action: () => focusOnFrequent('ÊÜ≤Ê≥ï')
                },
                {
                    text: "Âæ©Áøí„ÅÆ„Çø„Ç§„Éü„É≥„Ç∞„Åß„Åô„ÄÇ3Êó•Ââç„Å´ÈñìÈÅï„Åà„ÅüÂïèÈ°å„ÇíÁ¢∫Ë™ç„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ",
                    action: () => showReviewQuestions()
                }
            ];
            
            const randomSuggestion = suggestions[Math.floor(Math.random() * suggestions.length)];
            document.getElementById('aiSuggestion').textContent = randomSuggestion.text;
            window.currentAISuggestion = randomSuggestion.action;
        }
        
        function acceptAISuggestion() {
            if (window.currentAISuggestion) {
                window.currentAISuggestion();
            }
        }
        
        function refreshAISuggestion() {
            updateAISuggestion();
        }
        
        // ÁõÆÊ®ôÁÆ°ÁêÜ
        function updateDailyGoals(questions, time, accuracy) {
            dailyGoals = { questions, time, accuracy };
            updateGoalDisplay();
            localStorage.setItem('dailyGoals', JSON.stringify(dailyGoals));
        }
        
        function updateGoalDisplay() {
            document.getElementById('dailyGoalValue').textContent = 
                `${dailyProgress.questions}/${dailyGoals.questions}`;
            document.getElementById('dailyGoalProgress').style.width = 
                `${Math.min(100, (dailyProgress.questions / dailyGoals.questions) * 100)}%`;
            
            document.getElementById('timeGoalValue').textContent = 
                `${dailyProgress.time}/${dailyGoals.time}`;
            document.getElementById('timeGoalProgress').style.width = 
                `${Math.min(100, (dailyProgress.time / dailyGoals.time) * 100)}%`;
            
            document.getElementById('accuracyGoalValue').textContent = 
                `${dailyProgress.accuracy}%`;
            document.getElementById('accuracyGoalProgress').style.width = 
                `${Math.min(100, (dailyProgress.accuracy / dailyGoals.accuracy) * 100)}%`;
        }
        
        function saveDailyProgress() {
            localStorage.setItem('dailyProgress', JSON.stringify({
                ...dailyProgress,
                date: new Date().toDateString()
            }));
        }
        
        function loadDailyProgress() {
            const saved = localStorage.getItem('dailyProgress');
            if (saved) {
                const data = JSON.parse(saved);
                if (data.date === new Date().toDateString()) {
                    dailyProgress = data;
                }
            }
            
            const goals = localStorage.getItem('dailyGoals');
            if (goals) {
                dailyGoals = JSON.parse(goals);
            }
            
            updateGoalDisplay();
        }
        
        // Â≠¶Áøí‰∫àÊ∏¨
        function updatePredictionScore() {
            const totalAnswered = calculateTotalAnswered();
            const avgAccuracy = calculateAverageAccuracy();
            const streakDays = parseInt(localStorage.getItem('streakDays') || '0');
            
            // ‰∫àÊ∏¨„Çπ„Ç≥„Ç¢Ë®àÁÆó
            let score = 50; // Âü∫Ê∫ñÁÇπ
            score += Math.min(20, totalAnswered / 100); // Ëß£Á≠îÊï∞„Å´„Çà„ÇãÂä†ÁÇπ
            score += Math.min(20, avgAccuracy / 5); // Ê≠£Á≠îÁéá„Å´„Çà„ÇãÂä†ÁÇπ
            score += Math.min(10, streakDays / 3); // Á∂ôÁ∂öÊó•Êï∞„Å´„Çà„ÇãÂä†ÁÇπ
            
            score = Math.min(100, Math.round(score));
            
            document.getElementById('predictionScore').textContent = `${score}%`;
            
            // „Éï„Ç°„ÇØ„Çø„ÉºÊõ¥Êñ∞
            updatePredictionFactors(totalAnswered, avgAccuracy, streakDays);
            
            return score;
        }
        
        function updatePredictionFactors(totalAnswered, avgAccuracy, streakDays) {
            // Á∂ôÁ∂öÊÄß„Çπ„Ç≥„Ç¢
            const continuityStars = Math.min(5, Math.ceil(streakDays / 7));
            updateFactorStars('continuityScore', continuityStars);
            
            // ÁêÜËß£Â∫¶„Çπ„Ç≥„Ç¢
            const understandingStars = Math.min(5, Math.ceil(avgAccuracy / 20));
            updateFactorStars('understandingScore', understandingStars);
            
            // Âº±ÁÇπÂÖãÊúç„Çπ„Ç≥„Ç¢
            const weaknessStars = calculateWeaknessOvercomeScore();
            updateFactorStars('weaknessScore', weaknessStars);
        }
        
        function updateFactorStars(elementId, count) {
            const element = document.getElementById(elementId);
            if (!element) return;
            
            let html = '';
            for (let i = 0; i < 5; i++) {
                if (i < count) {
                    html += '<span class="factor-star">‚≠ê</span>';
                } else {
                    html += '<span class="factor-star" style="opacity: 0.3;">‚≠ê</span>';
                }
            }
            element.innerHTML = html;
        }
        
        // Ê®°Êì¨Ë©¶È®ìÊ©üËÉΩ
        function startExam() {
            examMode = true;
            examCurrentQuestion = 0;
            examAnswers = {};
            examTimeLeft = 10800;
            
            // ÂïèÈ°å„ÇíÁîüÊàê
            generateExamQuestions();
            
            // „Çø„Ç§„Éû„ÉºÈñãÂßã
            startExamTimer();
            
            // UIÊõ¥Êñ∞
            document.getElementById('endExamBtn').style.display = 'block';
            showExamQuestion(0);
        }
        
        function generateExamQuestions() {
            examQuestions = [];
            
            // ÂêÑÁßëÁõÆ„Åã„ÇâÂïèÈ°å„ÇíÈÅ∏Êäû
            const subjects = {
                'Âü∫Á§éÊ≥ïÂ≠¶': 2,
                'ÊÜ≤Ê≥ï': 5,
                'Ë°åÊîøÊ≥ï': 19,
                'Ê∞ëÊ≥ï': 9,
                'ÂïÜÊ≥ï': 5,
                '‰∏ÄËà¨Áü•Ë≠ò': 14
            };
            
            Object.entries(subjects).forEach(([subject, count]) => {
                for (let i = 0; i < count; i++) {
                    examQuestions.push({
                        id: examQuestions.length + 1,
                        subject: subject,
                        question: `${subject} ÂïèÈ°å ${i + 1}`,
                        difficulty: ['easy', 'medium', 'hard'][Math.floor(Math.random() * 3)]
                    });
                }
            });
        }
        
        function startExamTimer() {
            examTimerInterval = setInterval(() => {
                examTimeLeft--;
                updateExamTimer();
                
                if (examTimeLeft <= 0) {
                    endExam();
                }
            }, 1000);
        }
        
        function updateExamTimer() {
            const hours = Math.floor(examTimeLeft / 3600);
            const minutes = Math.floor((examTimeLeft % 3600) / 60);
            const seconds = examTimeLeft % 60;
            
            document.getElementById('examTimer').textContent = 
                `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
        }
        
        function showExamQuestion(index) {
            examCurrentQuestion = index;
            const question = examQuestions[index];
            
            document.getElementById('examQuestionContent').innerHTML = `
                <h4>ÂïèÈ°å ${question.id} (${question.subject})</h4>
                <p>„Åì„Åì„Å´ÂïèÈ°åÊñá„ÅåË°®Á§∫„Åï„Çå„Åæ„Åô...</p>
                <div class="difficulty-selector">
                    <button class="difficulty-btn ${question.difficulty}" disabled>
                        Èõ£ÊòìÂ∫¶: ${question.difficulty === 'easy' ? 'Á∞°Âçò' : 
                                 question.difficulty === 'medium' ? 'ÊôÆÈÄö' : 'Èõ£„Åó„ÅÑ'}
                    </button>
                </div>
            `;
            
            updateExamProgress();
            updateExamQuestionNav();
        }
        
        function updateExamProgress() {
            const answered = Object.keys(examAnswers).length;
            const progress = (answered / examQuestions.length) * 100;
            document.getElementById('examProgress').style.width = `${progress}%`;
        }
        
        function generateExamQuestionNav() {
            const nav = document.getElementById('examQuestionNav');
            if (!nav) return;
            
            let html = '';
            for (let i = 1; i <= 60; i++) {
                html += `<button class="exam-nav-btn" id="examNav${i}" onclick="showExamQuestion(${i-1})">${i}</button>`;
            }
            nav.innerHTML = html;
        }
        
        function updateExamQuestionNav() {
            for (let i = 0; i < examQuestions.length; i++) {
                const btn = document.getElementById(`examNav${i + 1}`);
                if (!btn) continue;
                
                btn.classList.remove('current', 'answered', 'flagged');
                
                if (i === examCurrentQuestion) {
                    btn.classList.add('current');
                }
                if (examAnswers[i]) {
                    btn.classList.add('answered');
                }
            }
        }
        
        function endExam() {
            clearInterval(examTimerInterval);
            examMode = false;
            
            // ÁµêÊûú„ÇíË°®Á§∫
            const answered = Object.keys(examAnswers).length;
            const score = calculateExamScore();
            
            alert(`Ë©¶È®ìÁµÇ‰∫ÜÔºÅ\nËß£Á≠îÊï∞: ${answered}/60\n‰∫àÊÉ≥ÂæóÁÇπ: ${score}ÁÇπ`);
            
            // „É™„Çª„ÉÉ„Éà
            document.getElementById('endExamBtn').style.display = 'none';
        }
        
        function calculateExamScore() {
            // ‰ªÆ„ÅÆË®àÁÆó
            return Math.floor(Math.random() * 40) + 140;
        }
        
        // Âæ©Áøí„Çπ„Ç±„Ç∏„É•„Éº„É´
        function updateReviewSchedule() {
            const timeline = document.getElementById('reviewTimeline');
            if (!timeline) return;
            
            const schedules = generateReviewSchedules();
            
            let html = '';
            schedules.forEach(schedule => {
                const urgency = schedule.daysUntil === 0 ? 'urgent' : '';
                html += `
                    <div class="review-item ${urgency}">
                        <div class="review-date">${schedule.dateLabel}</div>
                        <div class="review-content">${schedule.content}</div>
                        <div class="review-stats">${schedule.stats}</div>
                    </div>
                `;
            });
            
            timeline.innerHTML = html;
        }
        
        function generateReviewSchedules() {
            const schedules = [];
            const today = new Date();
            
            // „Ç®„Éì„É≥„Ç∞„Éè„Ç¶„Çπ„ÅÆÂøòÂç¥Êõ≤Á∑ö„Å´Âü∫„Å•„ÅèÂæ©ÁøíÈñìÈöî
            const intervals = [1, 3, 7, 14, 30]; // Êó•Êï∞
            
            allRecords.forEach(record => {
                const recordDate = new Date(record.timestamp);
                const daysSince = Math.floor((today - recordDate) / (1000 * 60 * 60 * 24));
                
                intervals.forEach(interval => {
                    if (daysSince === interval - 1) {
                        schedules.push({
                            daysUntil: 0,
                            dateLabel: '‰ªäÊó•',
                            content: record.path.join(' ‚Ä∫ '),
                            stats: `ÂâçÂõûÊ≠£Á≠îÁéá: ${record.stats.rate} | Âæ©ÁøíÂõûÊï∞: ${interval === 1 ? 1 : 
                                    interval === 3 ? 2 : interval === 7 ? 3 : interval === 14 ? 4 : 5}Âõû`
                        });
                    }
                });
            });
            
            return schedules.slice(0, 5);
        }
        
        // „Çø„Ç∞ÁÆ°ÁêÜ
        function addNewTag() {
            const input = document.getElementById('newTagInput');
            const tag = input.value.trim();
            
            if (tag) {
                noteTags.add(tag);
                input.value = '';
                updateTagCloud();
                saveTagsToStorage();
            }
        }
        
        function updateTagCloud() {
            const cloud = document.getElementById('tagCloud');
            if (!cloud) return;
            
            const tagCounts = {};
            
            // „Çø„Ç∞„ÅÆ‰ΩøÁî®ÂõûÊï∞„Çí„Ç´„Ç¶„É≥„Éà
            Object.values(questionNotes).forEach(note => {
                if (note.tags) {
                    note.tags.forEach(tag => {
                        tagCounts[tag] = (tagCounts[tag] || 0) + 1;
                    });
                }
            });
            
            let html = '';
            noteTags.forEach(tag => {
                const count = tagCounts[tag] || 0;
                html += `
                    <div class="tag-item" onclick="filterByTag('${tag}')">
                        <span>${tag}</span>
                        <span class="tag-count">(${count})</span>
                        <span class="tag-remove" onclick="removeTag('${tag}', event)">√ó</span>
                    </div>
                `;
            });
            
            cloud.innerHTML = html;
        }
        
        function removeTag(tag, event) {
            event.stopPropagation();
            noteTags.delete(tag);
            updateTagCloud();
            saveTagsToStorage();
        }
        
        // ÈñìÈÅï„ÅÑÂïèÈ°åÈõÜ
        function updateMistakeList() {
            const list = document.getElementById('mistakeList');
            if (!list) return;
            
            const mistakes = collectMistakes();
            const filtered = filterMistakesByType(mistakes, mistakeFilter);
            
            let html = '';
            filtered.slice(0, 10).forEach(mistake => {
                html += `
                    <div class="mistake-item">
                        <div class="mistake-header">
                            <div class="mistake-title">${mistake.path}</div>
                            <div class="mistake-count">${mistake.count}Âõû</div>
                        </div>
                        <div class="mistake-meta">
                            ÊúÄÁµÇ: ${new Date(mistake.lastDate).toLocaleDateString()} | 
                            Ê≠£Á≠îÁéá: ${mistake.accuracy}%
                        </div>
                    </div>
                `;
            });
            
            list.innerHTML = html || '<p style="text-align: center; color: var(--gray);">Ë©≤ÂΩì„Åô„ÇãÂïèÈ°å„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</p>';
        }
        
        function collectMistakes() {
            const mistakeMap = {};
            
            allRecords.forEach(record => {
                Object.entries(record.questions || {}).forEach(([num, state]) => {
                    if (state.state === 'wrong') {
                        const key = `${record.path.join(' ‚Ä∫ ')} - Âïè${num}`;
                        if (!mistakeMap[key]) {
                            mistakeMap[key] = {
                                path: key,
                                count: 0,
                                lastDate: record.timestamp,
                                bookmarked: state.bookmarked,
                                accuracy: 0
                            };
                        }
                        mistakeMap[key].count++;
                        mistakeMap[key].lastDate = record.timestamp;
                    }
                });
            });
            
            return Object.values(mistakeMap);
        }
        
        function filterMistakesByType(mistakes, type) {
            switch(type) {
                case 'recent':
                    return mistakes.filter(m => {
                        const days = (Date.now() - new Date(m.lastDate)) / (1000 * 60 * 60 * 24);
                        return days <= 7;
                    });
                case 'frequent':
                    return mistakes.sort((a, b) => b.count - a.count).slice(0, 20);
                case 'bookmarked':
                    return mistakes.filter(m => m.bookmarked);
                default:
                    return mistakes;
            }
        }
        
        function filterMistakes(type, element) {
            mistakeFilter = type;
            document.querySelectorAll('.filter-chip').forEach(chip => {
                chip.classList.remove('active');
            });
            element.classList.add('active');
            updateMistakeList();
        }
        
        // „É™„Éû„Ç§„É≥„ÉÄ„ÉºÊ©üËÉΩ
        function toggleReminder(element) {
            element.classList.toggle('active');
            saveRemindersToStorage();
            
            if (element.classList.contains('active')) {
                scheduleNotification(element);
            }
        }
        
        function scheduleNotification(reminderElement) {
            if ('Notification' in window) {
                Notification.requestPermission().then(permission => {
                    if (permission === 'granted') {
                        // ÂÆüÈöõ„ÅÆ„Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞Âá¶ÁêÜ
                        console.log('Reminder scheduled');
                    }
                });
            }
        }
        
        function showNotification(title, body) {
            if ('Notification' in window && Notification.permission === 'granted') {
                new Notification(title, {
                    body: body,
                    icon: 'üìö'
                });
            }
        }
        
        // „Éá„Éº„Çø„Ç®„ÇØ„Çπ„Éù„Éº„Éà/„Ç§„É≥„Éù„Éº„Éà
        function exportData(format) {
            const data = {
                books: books,
                records: allRecords,
                questionStates: savedQuestionStates,
                tags: Array.from(noteTags),
                notes: questionNotes,
                goals: dailyGoals,
                progress: dailyProgress,
                timestamp: new Date().toISOString()
            };
            
            switch(format) {
                case 'json':
                    downloadJSON(data);
                    break;
                case 'csv':
                    downloadCSV(data);
                    break;
                case 'pdf':
                    generatePDFReport(data);
                    break;
            }
        }
        
        function downloadJSON(data) {
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `study_tracker_${new Date().toISOString().split('T')[0]}.json`;
            a.click();
        }
        
        function downloadCSV(data) {
            let csv = 'Date,Book,Path,Total,Correct,Wrong,Rate\n';
            
            data.records.forEach(record => {
                csv += `${new Date(record.timestamp).toLocaleDateString()},`;
                csv += `"${record.bookName}",`;
                csv += `"${record.path.join(' > ')}",`;
                csv += `${record.stats.total},`;
                csv += `${record.stats.correct},`;
                csv += `${record.stats.wrong},`;
                csv += `${record.stats.rate}\n`;
            });
            
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `study_records_${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
        }
        
        function generatePDFReport(data) {
            // PDFÁîüÊàê„ÅÆÁ∞°ÊòìÂÆüË£ÖÔºàÂÆüÈöõ„Å´„ÅØ„É©„Ç§„Éñ„É©„É™„ÅåÂøÖË¶ÅÔºâ
            alert('PDFÂá∫ÂäõÊ©üËÉΩ„ÅØÊ∫ñÂÇô‰∏≠„Åß„Åô„ÄÇJSONÂΩ¢Âºè„Åß„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
        }
        
        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            
            input.onchange = e => {
                const file = e.target.files[0];
                const reader = new FileReader();
                
                reader.onload = event => {
                    try {
                        const data = JSON.parse(event.target.result);
                        
                        if (confirm('„Éá„Éº„Çø„Çí„Ç§„É≥„Éù„Éº„Éà„Åó„Åæ„Åô„ÅãÔºüÁèæÂú®„ÅÆ„Éá„Éº„Çø„ÅØ‰∏äÊõ∏„Åç„Åï„Çå„Åæ„Åô„ÄÇ')) {
                            books = data.books || {};
                            allRecords = data.records || [];
                            savedQuestionStates = data.questionStates || {};
                            noteTags = new Set(data.tags || []);
                            questionNotes = data.notes || {};
                            dailyGoals = data.goals || dailyGoals;
                            dailyProgress = data.progress || dailyProgress;
                            
                            saveAllData();
                            location.reload();
                        }
                    } catch (error) {
                        alert('„Éï„Ç°„Ç§„É´„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇ');
                        console.error(error);
                    }
                };
                
                reader.readAsText(file);
            };
            
            input.click();
        }
        
        // ÂäπÁéáÊÄßÂàÜÊûê
        function updateEfficiencyChart() {
            const chartData = calculateEfficiencyData();
            
            // SVG„ÉÅ„É£„Éº„ÉàÊõ¥Êñ∞
            const line = document.getElementById('efficiencyLine');
            const area = document.getElementById('efficiencyArea');
            
            if (line && area) {
                const points = chartData.map((d, i) => 
                    `${i * 50},${150 - d.efficiency * 1.5}`
                ).join(' ');
                
                line.setAttribute('points', points);
                area.setAttribute('points', `0,150 ${points} ${(chartData.length - 1) * 50},150`);
            }
            
            // Áµ±Ë®àÊõ¥Êñ∞
            updateEfficiencyStats(chartData);
        }
        
        function calculateEfficiencyData() {
            const data = [];
            const days = 7;
            
            for (let i = days - 1; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                
                const dayRecords = allRecords.filter(r => 
                    new Date(r.timestamp).toDateString() === date.toDateString()
                );
                
                let efficiency = 0;
                if (dayRecords.length > 0) {
                    const totalTime = dayRecords.reduce((sum, r) => sum + (r.timeSpent || 30), 0);
                    const totalQuestions = dayRecords.reduce((sum, r) => sum + r.stats.total, 0);
                    const totalCorrect = dayRecords.reduce((sum, r) => sum + r.stats.correct, 0);
                    
                    efficiency = (totalQuestions / totalTime) * (totalCorrect / totalQuestions) * 100;
                }
                
                data.push({
                    date: date,
                    efficiency: Math.min(100, efficiency)
                });
            }
            
            return data;
        }
        
        function updateEfficiencyStats(data) {
            const avgSpeed = calculateAverageSpeed();
            const focusScore = calculateFocusScore();
            const retentionRate = calculateRetentionRate();
            
            document.getElementById('avgSpeed').textContent = avgSpeed;
            document.getElementById('focusScore').textContent = `${focusScore}%`;
            document.getElementById('retentionRate').textContent = `${retentionRate}%`;
        }
        
        function calculateAverageSpeed() {
            if (allRecords.length === 0) return 0;
            
            const recentRecords = allRecords.slice(-10);
            const totalQuestions = recentRecords.reduce((sum, r) => sum + r.stats.total, 0);
            const totalTime = recentRecords.reduce((sum, r) => sum + (r.timeSpent || 30), 0);
            
            return Math.round(totalQuestions / (totalTime / 60));
        }
        
        function calculateFocusScore() {
            // „Éù„É¢„Éâ„Éº„É≠ÂÆå‰∫ÜÁéá„Åã„ÇâË®àÁÆó
            const targetPomodoros = 8; // 1Êó•„ÅÆÁõÆÊ®ô
            const completedPomodoros = pomodoroCount;
            
            return Math.min(100, Math.round((completedPomodoros / targetPomodoros) * 100));
        }
        
        function calculateRetentionRate() {
            // Âæ©ÁøíÂïèÈ°å„ÅÆÊ≠£Á≠îÁéá„Åã„ÇâË®àÁÆó
            const reviewRecords = allRecords.filter(r => r.isReview);
            
            if (reviewRecords.length === 0) return 75;
            
            const totalCorrect = reviewRecords.reduce((sum, r) => sum + r.stats.correct, 0);
            const totalQuestions = reviewRecords.reduce((sum, r) => sum + r.stats.total, 0);
            
            return Math.round((totalCorrect / totalQuestions) * 100);
        }
        
        // Ë©≥Á¥∞„É¨„Éù„Éº„Éà
        function updateSubjectReport() {
            const tbody = document.getElementById('subjectReportBody');
            if (!tbody) return;
            
            const subjectData = calculateDetailedSubjectStats();
            
            let html = '';
            Object.entries(subjectData).forEach(([subject, data]) => {
                const trend = data.trend > 0 ? '‚Üë' : data.trend < 0 ? '‚Üì' : '‚Üí';
                const trendColor = data.trend > 0 ? 'var(--success)' : 
                                   data.trend < 0 ? 'var(--danger)' : 'var(--gray)';
                
                const priority = data.accuracy < 60 ? 'ÊúÄÂÑ™ÂÖà' :
                                data.accuracy < 75 ? 'ÂÑ™ÂÖà' :
                                data.accuracy < 85 ? 'Ê®ôÊ∫ñ' : 'Á∂≠ÊåÅ';
                
                const priorityColor = data.accuracy < 60 ? 'var(--danger)' :
                                     data.accuracy < 75 ? 'var(--warning)' :
                                     data.accuracy < 85 ? 'var(--primary)' : 'var(--success)';
                
                html += `
                    <tr>
                        <td>${subject}</td>
                        <td>${data.total}</td>
                        <td>${data.accuracy}%</td>
                        <td style="color: ${trendColor};">${trend} ${Math.abs(data.trend)}%</td>
                        <td><span style="color: ${priorityColor}; font-weight: 600;">${priority}</span></td>
                    </tr>
                `;
            });
            
            tbody.innerHTML = html;
        }
        
        function calculateDetailedSubjectStats() {
            const stats = {};
            const subjects = ['Âü∫Á§éÊ≥ïÂ≠¶', 'ÊÜ≤Ê≥ï', 'Ë°åÊîøÊ≥ï', 'Ê∞ëÊ≥ï', 'ÂïÜÊ≥ï', '‰∏ÄËà¨Áü•Ë≠ò'];
            
            subjects.forEach(subject => {
                const subjectRecords = allRecords.filter(r => 
                    r.path && r.path[0] === subject
                );
                
                const total = subjectRecords.reduce((sum, r) => sum + r.stats.total, 0);
                const correct = subjectRecords.reduce((sum, r) => sum + r.stats.correct, 0);
                const accuracy = total > 0 ? Math.round((correct / total) * 100) : 0;
                
                // ÂâçÈÄ±„Å®„ÅÆÊØîËºÉ
                const lastWeek = new Date();
                lastWeek.setDate(lastWeek.getDate() - 7);
                
                const lastWeekRecords = subjectRecords.filter(r => 
                    new Date(r.timestamp) < lastWeek
                );
                
                const lastWeekTotal = lastWeekRecords.reduce((sum, r) => sum + r.stats.total, 0);
                const lastWeekCorrect = lastWeekRecords.reduce((sum, r) => sum + r.stats.correct, 0);
                const lastWeekAccuracy = lastWeekTotal > 0 ? 
                    Math.round((lastWeekCorrect / lastWeekTotal) * 100) : 0;
                
                stats[subject] = {
                    total,
                    correct,
                    accuracy,
                    trend: accuracy - lastWeekAccuracy
                };
            });
            
            return stats;
        }
        
        // „Çπ„Éî„Éº„Éâ„É°„Éº„Çø„ÉºÊõ¥Êñ∞
        function updateSpeedometer(value) {
            const needle = document.getElementById('speedometerNeedle');
            const valueElement = document.getElementById('speedometerValue');
            
            if (needle && valueElement) {
                const angle = -90 + (value / 100) * 180;
                needle.style.transform = `rotate(${angle}deg)`;
                valueElement.textContent = `${value}%`;
            }
        }
        
        // „É¢„ÉÅ„Éô„Éº„Ç∑„Éß„É≥Ê©üËÉΩ
        function updateMotivationBanner() {
            const streakDays = parseInt(localStorage.getItem('streakDays') || '0');
            const message = motivationMessages[Math.floor(Math.random() * motivationMessages.length)];
            
            document.getElementById('streakDays').textContent = streakDays;
            document.querySelector('.motivation-message').textContent = message;
            
            // ÁâπÂà•„Å™„Éû„Ç§„É´„Çπ„Éà„Éº„É≥
            if (streakDays === 7) {
                showSpecialAchievement('1ÈÄ±ÈñìÈÄ£Á∂öÈÅîÊàêÔºÅ');
            } else if (streakDays === 30) {
                showSpecialAchievement('1„É∂ÊúàÈÄ£Á∂öÈÅîÊàêÔºÅ');
            } else if (streakDays === 100) {
                showSpecialAchievement('100Êó•ÈÄ£Á∂öÈÅîÊàêÔºÅ');
            }
        }
        
        function showSpecialAchievement(message) {
            const banner = document.getElementById('motivationBanner');
            banner.style.background = 'linear-gradient(135deg, #667eea, #f093fb)';
            banner.innerHTML += `
                <div style="margin-top: 10px; font-size: 20px;">
                    üéâ ${message} üéâ
                </div>
            `;
            
            setTimeout(() => {
                updateMotivationBanner();
            }, 5000);
        }
        
        // „Éé„Éº„ÉàÊ©üËÉΩ
        function addNoteTag(tag) {
            const currentTags = document.getElementById('noteTags');
            const existingTags = Array.from(currentTags.children).map(child => 
                child.textContent.replace('√ó', '').trim()
            );
            
            if (!existingTags.includes(tag)) {
                const tagElement = document.createElement('div');
                tagElement.className = 'note-tag';
                tagElement.innerHTML = `${tag} <span onclick="removeNoteTag(this)">√ó</span>`;
                currentTags.appendChild(tagElement);
            }
        }
        
        function removeNoteTag(element) {
            element.parentElement.remove();
        }
        
        function saveQuestionNote() {
            const note = document.getElementById('questionNote').value;
            const tags = Array.from(document.getElementById('noteTags').children).map(child => 
                child.textContent.replace('√ó', '').trim()
            );
            
            if (currentBook && currentPath.length > 0) {
                const key = `${currentBook.id}_${currentPath.join('/')}`;
                questionNotes[key] = {
                    note: note,
                    tags: tags,
                    timestamp: new Date().toISOString()
                };
                
                localStorage.setItem('questionNotes', JSON.stringify(questionNotes));
            }
        }
        
        // Èõ£ÊòìÂ∫¶ÁÆ°ÁêÜ
        function setDifficulty(level, element) {
            document.querySelectorAll('.difficulty-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            element.classList.add('selected');
            
            if (currentBook && currentPath.length > 0) {
                const key = `${currentBook.id}_${currentPath.join('/')}`;
                questionDifficulty[key] = level;
                localStorage.setItem('questionDifficulty', JSON.stringify(questionDifficulty));
            }
        }
        
        // „ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„ÉâÊõ¥Êñ∞
        function updateDashboard() {
            updatePredictionScore();
            updateGoalDisplay();
            updateMotivationBanner();
            updateEfficiencyChart();
            updateSubjectReport();
            updateSpeedometer(updatePredictionScore());
        }
        
        // Ë£úÂä©Èñ¢Êï∞
        function calculateTotalAnswered() {
            return allRecords.reduce((sum, r) => sum + (r.stats.total || 0), 0);
        }
        
        function calculateAverageAccuracy() {
            const total = allRecords.reduce((sum, r) => sum + (r.stats.total || 0), 0);
            const correct = allRecords.reduce((sum, r) => sum + (r.stats.correct || 0), 0);
            
            return total > 0 ? Math.round((correct / total) * 100) : 0;
        }
        
        function calculateWeaknessOvercomeScore() {
            // Âº±ÁÇπÁßëÁõÆ„ÅÆÊîπÂñÑÂ∫¶„ÇíË®àÁÆó
            const weakSubjects = [];
            const subjectStats = calculateDetailedSubjectStats();
            
            Object.entries(subjectStats).forEach(([subject, data]) => {
                if (data.accuracy < 70) {
                    weakSubjects.push({
                        subject,
                        improvement: data.trend
                    });
                }
            });
            
            if (weakSubjects.length === 0) return 5;
            
            const avgImprovement = weakSubjects.reduce((sum, s) => sum + s.improvement, 0) / weakSubjects.length;
            
            return Math.min(5, Math.max(1, Math.round(avgImprovement / 5) + 3));
        }
        
        function focusOnSubject(subject) {
            // ÁâπÂÆöÁßëÁõÆ„Å´„Éï„Ç©„Éº„Ç´„Çπ
            alert(`${subject}„ÅÆÂ≠¶Áøí„ÇíÂÑ™ÂÖàÁöÑ„Å´Ë°®Á§∫„Åó„Åæ„Åô`);
            // ÂÆüË£Ö: „Éï„Ç£„É´„Çø„É™„É≥„Ç∞„Å™„Å©
        }
        
        function increaseDifficulty(subject) {
            alert(`${subject}„ÅÆÈõ£ÊòìÂ∫¶„Çí‰∏ä„Åí„Åæ„Åô`);
            // ÂÆüË£Ö: Èõ£ÊòìÂ∫¶„Éï„Ç£„É´„Çø„É™„É≥„Ç∞
        }
        
        function focusOnFrequent(subject) {
            alert(`${subject}„ÅÆÈ†ªÂá∫ÂïèÈ°å„ÇíË°®Á§∫„Åó„Åæ„Åô`);
            // ÂÆüË£Ö: È†ªÂá∫ÂïèÈ°å„Éï„Ç£„É´„Çø„É™„É≥„Ç∞
        }
        
        function showReviewQuestions() {
            alert('Âæ©Áøí„ÅåÂøÖË¶Å„Å™ÂïèÈ°å„ÇíË°®Á§∫„Åó„Åæ„Åô');
            // ÂÆüË£Ö: Âæ©ÁøíÂïèÈ°å„ÅÆË°®Á§∫
        }
        
        function showDateDetails(dateStr) {
            const date = new Date(dateStr);
            const data = getDateStudyData(date);
            
            alert(`${date.toLocaleDateString()}\nËß£Á≠îÊï∞: ${data.count}Âïè\nÊ≠£Ëß£Êï∞: ${data.correct}Âïè`);
        }
        
        function filterByTag(tag) {
            alert(`„Çø„Ç∞„Äå${tag}„Äç„Åß„Éï„Ç£„É´„Çø„É™„É≥„Ç∞„Åó„Åæ„Åô`);
            // ÂÆüË£Ö: „Çø„Ç∞„Éï„Ç£„É´„Çø„É™„É≥„Ç∞
        }
        
        function exportReport(format) {
            exportData(format);
        }
        
        function shareReport() {
            if (navigator.share) {
                navigator.share({
                    title: 'Â≠¶Áøí„É¨„Éù„Éº„Éà',
                    text: 'Ë°åÊîøÊõ∏Â£´Ë©¶È®ì„ÅÆÂ≠¶ÁøíÈÄ≤Êçó',
                    url: window.location.href
                });
            } else {
                alert('ÂÖ±ÊúâÊ©üËÉΩ„ÅØ„Åì„ÅÆ„Éñ„É©„Ç¶„Ç∂„Åß„ÅØÂà©Áî®„Åß„Åç„Åæ„Åõ„Çì');
            }
        }
        
        // „ÉÄ„Éº„ÇØ„É¢„Éº„Éâ
        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
            localStorage.setItem('darkMode', document.body.classList.contains('dark-mode'));
        }
        
        // ÈÄöÁü•Ë°®Á§∫
        function showNotifications() {
            const notifications = [
                '‰ªäÊó•„ÅÆÁõÆÊ®ô„Åæ„Åß„ÅÇ„Å®10Âïè„Åß„Åô',
                'Âæ©Áøí„Çπ„Ç±„Ç∏„É•„Éº„É´„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ',
                'ÈÄ£Á∂öÂ≠¶ÁøíË®òÈå≤Êõ¥Êñ∞‰∏≠ÔºÅ'
            ];
            
            alert('ÈÄöÁü•:\n' + notifications.join('\n'));
        }
        
        // „Çπ„Éà„É¨„Éº„Ç∏‰øùÂ≠ò
        function saveAllData() {
            saveBooksToStorage();
            localStorage.setItem('studyHistory', JSON.stringify(allRecords));
            localStorage.setItem('savedQuestionStates', JSON.stringify(savedQuestionStates));
            localStorage.setItem('questionNotes', JSON.stringify(questionNotes));
            localStorage.setItem('questionDifficulty', JSON.stringify(questionDifficulty));
            localStorage.setItem('tags', JSON.stringify(Array.from(noteTags)));
            saveDailyProgress();
        }
        
        function saveRemindersToStorage() {
            const reminderElements = document.querySelectorAll('.reminder-toggle');
            const savedReminders = [];
            
            reminderElements.forEach((element, index) => {
                savedReminders.push({
                    index: index,
                    active: element.classList.contains('active')
                });
            });
            
            localStorage.setItem('reminders', JSON.stringify(savedReminders));
        }
        
        function saveTagsToStorage() {
            localStorage.setItem('tags', JSON.stringify(Array.from(noteTags)));
        }
        
        // Êó¢Â≠òÈñ¢Êï∞„ÅÆÊã°Âºµ
        function saveRecord() {
            // „Éé„Éº„Éà„Çí‰øùÂ≠ò
            saveQuestionNote();
            
            const record = {
                bookId: currentBook.id,
                bookName: currentBook.name,
                path: currentPath,
                questions: questionStates,
                timestamp: new Date().toISOString(),
                stats: {
                    total: parseInt(document.getElementById('totalCount').textContent),
                    correct: parseInt(document.getElementById('correctCount').textContent),
                    wrong: parseInt(document.getElementById('wrongCount').textContent),
                    rate: document.getElementById('correctRate').textContent
                },
                timeSpent: Math.floor(timerSeconds / 60),
                difficulty: questionDifficulty[`${currentBook.id}_${currentPath.join('/')}`] || 'medium'
            };
            
            saveToHistory(record);
            updateDailyStreak();
            loadAllRecords();
            
            // ÈÄ≤ÊçóÊõ¥Êñ∞
            dailyProgress.questions += record.stats.total;
            dailyProgress.accuracy = calculateAverageAccuracy();
            saveDailyProgress();
            updateGoalDisplay();
            
            // „ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„ÉâÊõ¥Êñ∞
            updateDashboard();
            
            alert('‰øùÂ≠ò„Åó„Åæ„Åó„ÅüÔºÅ');
        }
        
        // „É°„Ç§„É≥„Çø„ÉñÂàá„ÇäÊõø„ÅàÔºàÊã°ÂºµÁâàÔºâ
        function switchMainTab(tabName, event) {
            document.querySelectorAll('.main-tab').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            const tabElement = document.getElementById(tabName + '-tab');
            if (tabElement) {
                tabElement.classList.add('active');
            }
            
            // „Çø„Éñ„Åî„Å®„ÅÆÂàùÊúüÂåñÂá¶ÁêÜ
            switch(tabName) {
                case 'dashboard':
                    updateDashboard();
                    break;
                case 'analysis':
                    updateEfficiencyChart();
                    updateSubjectReport();
                    updateMistakeList();
                    break;
                case 'exam':
                    generateExamQuestionNav();
                    break;
                case 'review':
                    updateReviewSchedule();
                    updateTagCloud();
                    break;
                case 'group':
                    // „Ç∞„É´„Éº„ÉóÊ©üËÉΩ„ÅÆÊõ¥Êñ∞
                    break;
            }
        }
        
        // Êó¢Â≠ò„ÅÆÈñ¢Êï∞ÔºàÁúÅÁï•„Åï„Çå„Å¶„ÅÑ„ÅüÈÉ®ÂàÜ„ÇíË£úÂÆåÔºâ
        function loadBooksFromStorage() {
            const stored = localStorage.getItem('studyTrackerBooks');
            if (stored) {
                books = JSON.parse(stored);
            }
        }
        
        function saveBooksToStorage() {
            localStorage.setItem('studyTrackerBooks', JSON.stringify(books));
        }
        
        function loadAllRecords() {
            const history = localStorage.getItem('studyHistory');
            if (history) {
                allRecords = JSON.parse(history);
            }
        }
        
        function loadSavedQuestionStates() {
            const saved = localStorage.getItem('savedQuestionStates');
            if (saved) {
                savedQuestionStates = JSON.parse(saved);
            }
            
            const notes = localStorage.getItem('questionNotes');
            if (notes) {
                questionNotes = JSON.parse(notes);
            }
            
            const difficulty = localStorage.getItem('questionDifficulty');
            if (difficulty) {
                questionDifficulty = JSON.parse(difficulty);
            }
            
            const tags = localStorage.getItem('tags');
            if (tags) {
                noteTags = new Set(JSON.parse(tags));
            }
        }
        
        function saveToHistory(record) {
            let history = localStorage.getItem('studyHistory');
            history = history ? JSON.parse(history) : [];
            history.push(record);
            
            if (history.length > 1000) {
                history = history.slice(-1000);
            }
            
            localStorage.setItem('studyHistory', JSON.stringify(history));
        }
        
        function updateDailyStreak() {
            const today = new Date().toDateString();
            const lastStudyDate = localStorage.getItem('lastStudyDate');
            let streakDays = parseInt(localStorage.getItem('streakDays') || '0');
            
            if (lastStudyDate !== today) {
                const yesterday = new Date();
                yesterday.setDate(yesterday.getDate() - 1);
                
                if (lastStudyDate === yesterday.toDateString()) {
                    streakDays++;
                } else if (lastStudyDate !== today) {
                    streakDays = 1;
                }
                
                localStorage.setItem('lastStudyDate', today);
                localStorage.setItem('streakDays', streakDays.toString());
            }
        }
        
        // „Çµ„É≥„Éó„É´„Éá„Éº„ÇøÂàùÊúüÂåñÔºàÊó¢Â≠òÔºâ
        function initializeSampleData() {
            if (Object.keys(books).length === 0) {
                const sampleBooks = [
                    {
                        id: 'sample-2024',
                        name: 'ÂêàÊ†ºÈù©ÂëΩ ËÇ¢Âà•ÈÅéÂéªÂïèÈõÜ 2024Âπ¥Áâà',
                        examType: 'gyousei',
                        structure: {
                            'Ê∞ëÊ≥ï': {
                                type: 'subject',
                                children: {
                                    'Á∑èÂâá': {
                                        type: 'chapter',
                                        children: {
                                            'Ê®©Âà©ËÉΩÂäõ': {
                                                type: 'section',
                                                questions: [1, 2, 3, 4, 5]
                                            }
                                        }
                                    }
                                }
                            }
                        },
                        createdAt: new Date().toISOString()
                    }
                ];
                
                sampleBooks.forEach(book => {
                    books[book.id] = book;
                });
                
                saveBooksToStorage();
            }
        }
        
        // ÂïèÈ°åÈõÜ„Ç´„Éº„ÉâË°®Á§∫ÔºàÊó¢Â≠ò„ÅÆÂÆüË£Ö„Çí‰ΩøÁî®Ôºâ
        function renderBookCards() {
            const container = document.getElementById('bookCardsContainer');
            if (!container) return;
            
            let html = '';
            Object.values(books).forEach(book => {
                html += `
                    <div class="book-card" id="book-card-${book.id}" onclick="toggleBookCard('${book.id}')">
                        <div class="book-card-title">üìö ${book.name}</div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        function toggleBookCard(bookId) {
            if (selectedBookCard === bookId) {
                document.getElementById(`book-card-${bookId}`).classList.remove('selected');
                selectedBookCard = null;
                currentBook = null;
                currentPath = [];
                document.getElementById('breadcrumb').style.display = 'none';
                document.getElementById('recordHierarchyContainer').style.display = 'none';
                document.getElementById('questionSection').style.display = 'none';
            } else {
                document.querySelectorAll('.book-card').forEach(c => {
                    c.classList.remove('selected');
                });
                document.getElementById(`book-card-${bookId}`).classList.add('selected');
                selectedBookCard = bookId;
                selectBook(bookId);
            }
        }
        
        // ÂïèÈ°åÈõÜÈÅ∏Êäû
        function selectBook(bookId) {
            currentBook = books[bookId];
            currentPath = [];
            
            document.getElementById('breadcrumb').style.display = 'flex';
            document.getElementById('questionSection').style.display = 'none';
            updateBreadcrumb();
            renderRecordHierarchy();
        }
        
        // ÈöéÂ±§Ë°®Á§∫
        function renderRecordHierarchy() {
            const container = document.getElementById('recordHierarchyContainer');
            if (!container || !currentBook) return;
            
            container.style.display = 'block';
            
            let structure = currentBook.structure;
            if (currentPath.length > 0) {
                for (let i = 0; i < currentPath.length; i++) {
                    if (structure[currentPath[i]]) {
                        structure = structure[currentPath[i]].children || {};
                    }
                }
            }
            
            let html = '<div class="hierarchy-list">';
            html += renderRecordLevel(structure, currentPath);
            html += '</div>';
            
            container.innerHTML = html;
        }
        
        function renderRecordLevel(structure, basePath) {
            let html = '';
            
            Object.entries(structure).forEach(([name, item]) => {
                const currentPath = [...basePath, name];
                const pathStr = currentPath.join('/');
                const hasChildren = item.children && Object.keys(item.children).length > 0;
                const isExpanded = expandedNodes.has(pathStr);
                
                html += `<div class="hierarchy-item">`;
                
                if (item.questions) {
                    html += `
                        <div class="hierarchy-row" onclick="showQuestions('${pathStr}')">
                            <span style="width: 28px;"></span>
                            <span class="hierarchy-icon">${getHierarchyIcon(item.type)}</span>
                            <span class="hierarchy-label">${name}</span>
                            <span class="hierarchy-meta">${item.questions.length}Âïè</span>
                        </div>
                    `;
                    
                    if (hasChildren) {
                        html += `
                            <div class="hierarchy-children ${isExpanded ? 'expanded' : ''}">
                                ${renderRecordLevel(item.children, currentPath)}
                            </div>
                        `;
                    }
                } else if (hasChildren) {
                    html += `
                        <div class="hierarchy-row" onclick="toggleRecordNode('${pathStr}', event)">
                            <span class="hierarchy-toggle ${isExpanded ? 'expanded' : ''}">‚ñ∂</span>
                            <span class="hierarchy-icon">${getHierarchyIcon(item.type)}</span>
                            <span class="hierarchy-label">${name}</span>
                        </div>
                        <div class="hierarchy-children ${isExpanded ? 'expanded' : ''}">
                            ${renderRecordLevel(item.children, currentPath)}
                        </div>
                    `;
                }
                
                html += '</div>';
            });
            
            return html;
        }
        
        function toggleRecordNode(path, event) {
            event.stopPropagation();
            
            if (expandedNodes.has(path)) {
                expandedNodes.delete(path);
            } else {
                expandedNodes.add(path);
            }
            
            renderRecordHierarchy();
        }
        
        function getHierarchyIcon(type) {
            const icons = {
                'subject': 'üìÇ',
                'chapter': 'üìÑ',
                'section': 'üìë',
                'subsection': ''
            };
            return icons[type] || 'üìÑ';
        }
        
        // „Éë„É≥„Åè„Åö„É™„Çπ„Éà
        function updateBreadcrumb() {
            const breadcrumb = document.getElementById('breadcrumb');
            if (!currentBook) return;
            
            const items = [currentBook.name, ...currentPath];
            
            let html = '';
            items.forEach((item, index) => {
                if (index > 0) html += '<span class="breadcrumb-separator">‚Ä∫</span>';
                html += `<span class="breadcrumb-item ${index === items.length - 1 ? 'active' : ''}" 
                         onclick="navigateTo(${index - 1})">${item}</span>`;
            });
            
            breadcrumb.innerHTML = html;
        }
        
        function navigateTo(index) {
            if (index === -1) {
                currentPath = [];
                document.getElementById('recordHierarchyContainer').style.display = 'block';
                document.getElementById('questionSection').style.display = 'none';
                renderRecordHierarchy();
            } else {
                currentPath = currentPath.slice(0, index);
                document.getElementById('recordHierarchyContainer').style.display = 'block';
                document.getElementById('questionSection').style.display = 'none';
                renderRecordHierarchy();
            }
            updateBreadcrumb();
        }
        
        // ÂïèÈ°åË°®Á§∫
        function showQuestions(pathStr) {
            const pathArray = pathStr.split('/');
            currentPath = pathArray;
            updateBreadcrumb();
            
            let current = currentBook.structure;
            for (let i = 0; i < pathArray.length; i++) {
                if (current[pathArray[i]]) {
                    if (current[pathArray[i]].questions) {
                        const item = current[pathArray[i]];
                        document.getElementById('recordHierarchyContainer').style.display = 'none';
                        document.getElementById('questionSection').style.display = 'block';
                        
                        const grid = document.getElementById('questionGrid');
                        grid.innerHTML = '';
                        questionStates = {};
                        
                        item.questions.forEach(num => {
                            const cell = document.createElement('div');
                            cell.className = 'question-cell';
                            cell.textContent = num;
                            cell.dataset.number = num;
                            cell.onclick = () => toggleQuestion(num);
                            
                            grid.appendChild(cell);
                            
                            questionStates[num] = {
                                state: null,
                                bookmarked: false
                            };
                        });
                        
                        loadQuestionStatesForPath();
                        loadQuestionNoteForPath();
                        return;
                    }
                    current = current[pathArray[i]].children || {};
                }
            }
        }
        
        function loadQuestionStatesForPath() {
            if (currentBook && currentPath.length > 0) {
                const key = `${currentBook.id}_${currentPath.join('/')}`;
                if (savedQuestionStates[key]) {
                    questionStates = savedQuestionStates[key];
                    applyQuestionStates();
                }
            }
        }
        
        function loadQuestionNoteForPath() {
            if (currentBook && currentPath.length > 0) {
                const key = `${currentBook.id}_${currentPath.join('/')}`;
                if (questionNotes[key]) {
                    document.getElementById('questionNote').value = questionNotes[key].note || '';
                    const tags = questionNotes[key].tags || [];
                    document.getElementById('noteTags').innerHTML = '';
                    tags.forEach(tag => addNoteTag(tag));
                }
                
                if (questionDifficulty[key]) {
                    document.querySelectorAll('.difficulty-btn').forEach(btn => {
                        btn.classList.remove('selected');
                        if (btn.classList.contains(questionDifficulty[key])) {
                            btn.classList.add('selected');
                        }
                    });
                }
            }
        }
        
        function applyQuestionStates() {
            Object.entries(questionStates).forEach(([num, state]) => {
                const cell = document.querySelector(`[data-number="${num}"]`);
                if (cell) {
                    cell.classList.remove('correct', 'wrong', 'bookmarked');
                    if (state.state === 'correct') {
                        cell.classList.add('correct');
                    } else if (state.state === 'wrong') {
                        cell.classList.add('wrong');
                    }
                    if (state.bookmarked) {
                        cell.classList.add('bookmarked');
                    }
                }
            });
            updateStats();
        }
        
        function saveQuestionStatesForPath() {
            if (currentBook && currentPath.length > 0) {
                const key = `${currentBook.id}_${currentPath.join('/')}`;
                savedQuestionStates[key] = questionStates;
                localStorage.setItem('savedQuestionStates', JSON.stringify(savedQuestionStates));
            }
        }
        
        // ÂïèÈ°åÊìç‰Ωú
        function toggleQuestion(num) {
            if (bookmarkMode) {
                questionStates[num].bookmarked = !questionStates[num].bookmarked;
                const cell = document.querySelector(`[data-number="${num}"]`);
                cell.classList.toggle('bookmarked');
            } else {
                const cell = document.querySelector(`[data-number="${num}"]`);
                const state = questionStates[num];
                
                if (state.state === null) {
                    state.state = 'correct';
                    cell.classList.add('correct');
                } else if (state.state === 'correct') {
                    state.state = 'wrong';
                    cell.classList.remove('correct');
                    cell.classList.add('wrong');
                } else {
                    state.state = null;
                    cell.classList.remove('wrong');
                }
            }
            
            saveQuestionStatesForPath();
            updateStats();
        }
        
        function toggleBookmarkMode() {
            bookmarkMode = !bookmarkMode;
            const btn = document.getElementById('bookmarkBtn');
            btn.classList.toggle('active');
        }
        
        function markCorrect() {
            Object.keys(questionStates).forEach(num => {
                if (questionStates[num].state === null) {
                    questionStates[num].state = 'correct';
                    const cell = document.querySelector(`[data-number="${num}"]`);
                    if (cell) {
                        cell.classList.add('correct');
                    }
                }
            });
            saveQuestionStatesForPath();
            updateStats();
        }
        
        function markWrong() {
            Object.keys(questionStates).forEach(num => {
                if (questionStates[num].state === null) {
                    questionStates[num].state = 'wrong';
                    const cell = document.querySelector(`[data-number="${num}"]`);
                    if (cell) {
                        cell.classList.add('wrong');
                    }
                }
            });
            saveQuestionStatesForPath();
            updateStats();
        }
        
        function updateStats() {
            let total = 0;
            let correct = 0;
            let wrong = 0;
            
            Object.values(questionStates).forEach(state => {
                if (state.state !== null) {
                    total++;
                    if (state.state === 'correct') {
                        correct++;
                    } else {
                        wrong++;
                    }
                }
            });
            
            const rate = total > 0 ? Math.round((correct / total) * 100) : 0;
            
            document.getElementById('totalCount').textContent = total;
            document.getElementById('correctCount').textContent = correct;
            document.getElementById('wrongCount').textContent = wrong;
            document.getElementById('correctRate').textContent = rate + '%';
        }
        
        // „Éï„ÉÉ„Çø„Éº„Çø„Éñ
        function switchFooterTab(tabName, event) {
            const modal = document.getElementById('footerModal');
            const modalTitle = document.getElementById('modalTitle');
            const modalBody = document.getElementById('modalBody');
            
            const titles = {
                'register': 'üìù ÂïèÈ°åÈõÜÁôªÈå≤',
                'history': 'üìÖ Â≠¶ÁøíÂ±•Ê≠¥',
                'results': 'üèÜ Áç≤Âæó„Éê„ÉÉ„Ç∏',
                'settings': '‚öôÔ∏è Ë®≠ÂÆö'
            };
            
            modalTitle.textContent = titles[tabName];
            
            switch(tabName) {
                case 'register':
                    modalBody.innerHTML = getRegisterContent();
                    break;
                case 'history':
                    modalBody.innerHTML = getHistoryContent();
                    break;
                case 'results':
                    modalBody.innerHTML = getResultsContent();
                    break;
                case 'settings':
                    modalBody.innerHTML = getSettingsContent();
                    break;
            }
            
            modal.classList.add('active');
        }
        
        function closeFooterModal() {
            document.getElementById('footerModal').classList.remove('active');
        }
        
        function getRegisterContent() {
            let html = `
                <div class="save-button" style="margin: 10px;" onclick="showNewBookDialog()">Êñ∞Ë¶è‰ΩúÊàê</div>
                <div style="margin-top: 20px;">
                    <h4 style="padding: 0 10px;">ÁôªÈå≤Ê∏à„ÅøÂïèÈ°åÈõÜ</h4>
                    <div id="registerHierarchy"></div>
                </div>
            `;
            
            setTimeout(() => {
                renderRegisterHierarchy();
            }, 100);
            
            return html;
        }
        
        function getHistoryContent() {
            let html = '<div class="card" style="margin: 10px;">';
            
            allRecords.slice(-20).reverse().forEach(record => {
                const date = new Date(record.timestamp);
                html += `
                    <div style="padding: 10px; border-bottom: 1px solid var(--light);">
                        <div style="font-weight: 600;">${record.path.join(' ‚Ä∫ ')}</div>
                        <div style="font-size: 12px; color: var(--gray);">
                            ${date.toLocaleDateString('ja-JP')} ${date.toLocaleTimeString('ja-JP', {hour: '2-digit', minute: '2-digit'})}
                            | Ê≠£Á≠îÁéá: ${record.stats.rate}
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            return html;
        }
        
        function getResultsContent() {
            const stats = calculateOverallProgress();
            const streakDays = localStorage.getItem('streakDays') || '0';
            
            const badges = [
                { 
                    icon: 'üéØ', 
                    label: 'ÂàùÂ≠¶Áøí', 
                    unlocked: allRecords.length > 0,
                    value: allRecords.length > 0 ? 'ÈÅîÊàê' : 'Êú™ÈÅîÊàê'
                },
                { 
                    icon: 'üìö', 
                    label: '100Âïè', 
                    unlocked: stats.totalAnswered >= 100,
                    value: `${stats.totalAnswered}Âïè`
                },
                { 
                    icon: 'üî•', 
                    label: '7Êó•ÈÄ£Á∂ö', 
                    unlocked: parseInt(streakDays) >= 7,
                    value: `${streakDays}Êó•`
                },
                { 
                    icon: '‚≠ê', 
                    label: 'Ê≠£Á≠î90%', 
                    unlocked: stats.overallRate >= 90,
                    value: `${stats.overallRate}%`
                }
            ];
            
            let html = `
                <div class="card" style="margin: 10px;">
                    <h4 style="text-align: center; margin-bottom: 20px;">Áç≤Âæó„Éê„ÉÉ„Ç∏</h4>
                    <div class="achievement-grid">
            `;
            
            badges.forEach(badge => {
                html += `
                    <div class="achievement-card">
                        <div class="achievement-icon ${!badge.unlocked ? 'disabled' : ''}">${badge.icon}</div>
                        <div class="achievement-label">${badge.label}</div>
                        <div class="achievement-value">${badge.value}</div>
                    </div>
                `;
            });
            
            html += `
                    </div>
                </div>
            `;
            
            return html;
        }
        
        function getSettingsContent() {
            let html = `
                <div class="card" style="margin: 10px;">
                    <h4>üìñ ‰Ωø„ÅÑÊñπ</h4>
                    <ol style="margin-left: 20px; line-height: 1.8;">
                        <li>„ÄåÁôªÈå≤„Äç„Åã„ÇâÂïèÈ°åÈõÜ„Çí‰ΩúÊàê„Åó„ÄÅÈöéÂ±§ÊßãÈÄ†„ÇíË®≠ÂÆö</li>
                        <li>„ÄåË®òÈå≤ÂÖ•Âäõ„Äç„ÅßÂïèÈ°å„ÇíËß£„ÅÑ„ÅüÁµêÊûú„ÇíË®òÈå≤</li>
                        <li>„ÄåË©≥Á¥∞ÂàÜÊûê„Äç„ÅßÂ≠¶ÁøíÁä∂Ê≥Å„ÇíÁ¢∫Ë™ç</li>
                        <li>„ÄåÊ®°Êì¨Ë©¶È®ì„Äç„ÅßÊú¨Áï™ÂΩ¢Âºè„ÅÆÁ∑¥Áøí</li>
                        <li>„ÄåÂæ©ÁøíÁÆ°ÁêÜ„Äç„ÅßÂäπÁéáÁöÑ„Å™Âæ©ÁøíË®àÁîª</li>
                    </ol>
                </div>
                
                <div class="card" style="margin: 10px;">
                    <button class="save-button" style="background: var(--danger);" onclick="clearAllData()">„Åô„Åπ„Å¶„ÅÆ„Éá„Éº„Çø„ÇíÂâäÈô§</button>
                </div>
            `;
            
            return html;
        }
        
        function renderRegisterHierarchy() {
            const container = document.getElementById('registerHierarchy');
            if (!container) return;
            
            let html = '<div class="hierarchy-list">';
            
            Object.values(books).forEach(book => {
                const nodeId = `book_${book.id}`;
                const isExpanded = expandedNodes.has(nodeId);
                
                html += `
                    <div class="hierarchy-item">
                        <div class="hierarchy-row" onclick="toggleRegisterNode('${nodeId}', event)">
                            <span class="hierarchy-toggle ${isExpanded ? 'expanded' : ''}">‚ñ∂</span>
                            <span class="hierarchy-icon">üìö</span>
                            <span class="hierarchy-label">${book.name}</span>
                            <div class="hierarchy-actions">
                                <button class="hierarchy-action" onclick="addHierarchy('${book.id}', null, 'subject', event)" title="ÁßëÁõÆËøΩÂä†">+</button>
                                <button class="hierarchy-action delete" onclick="deleteBook('${book.id}', event)" title="ÂâäÈô§">üóëÔ∏è</button>
                            </div>
                        </div>
                        <div class="hierarchy-children ${isExpanded ? 'expanded' : ''}">
                            ${renderRegisterLevel(book.structure, book.id, [])}
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            container.innerHTML = html;
        }
        
        function renderRegisterLevel(structure, bookId, path) {
            let html = '';
            
            Object.entries(structure).forEach(([name, item]) => {
                const currentPath = [...path, name];
                const nodeId = `${bookId}_${currentPath.join('_')}`;
                const hasChildren = item.children && Object.keys(item.children).length > 0;
                const isExpanded = expandedNodes.has(nodeId);
                
                html += `
                    <div class="hierarchy-item">
                        <div class="hierarchy-row">
                            ${hasChildren ? `<span class="hierarchy-toggle ${isExpanded ? 'expanded' : ''}" onclick="toggleRegisterNode('${nodeId}', event)">‚ñ∂</span>` : '<span style="width: 28px; display: inline-block;"></span>'}
                            <span class="hierarchy-icon">${getHierarchyIcon(item.type)}</span>
                            <span class="hierarchy-label">${name}</span>
                `;
                
                if (item.questions) {
                    html += `<span class="hierarchy-meta">${item.questions.length}Âïè</span>`;
                }
                
                html += '<div class="hierarchy-actions">';
                html += `<button class="hierarchy-action edit" onclick="editHierarchy('${bookId}', '${currentPath.join('/')}', event)" title="Á∑®ÈõÜ">‚úèÔ∏è</button>`;
                
                if (item.type === 'subject') {
                    html += `<button class="hierarchy-action" onclick="addHierarchy('${bookId}', '${currentPath.join('/')}', 'chapter', event)" title="Á´†ËøΩÂä†">+</button>`;
                } else if (item.type === 'chapter') {
                    html += `<button class="hierarchy-action" onclick="addHierarchy('${bookId}', '${currentPath.join('/')}', 'section', event)" title="ÁØÄËøΩÂä†">+</button>`;
                }
                
                html += `<button class="hierarchy-action delete" onclick="deleteHierarchy('${bookId}', '${currentPath.join('/')}', event)" title="ÂâäÈô§">üóëÔ∏è</button>`;
                html += '</div></div>';
                
                if (hasChildren) {
                    html += `
                        <div class="hierarchy-children ${isExpanded ? 'expanded' : ''}">
                            ${renderRegisterLevel(item.children, bookId, currentPath)}
                        </div>
                    `;
                }
                
                html += '</div>';
            });
            
            return html;
        }
        
        function toggleRegisterNode(nodeId, event) {
            event.stopPropagation();
            
            if (expandedNodes.has(nodeId)) {
                expandedNodes.delete(nodeId);
            } else {
                expandedNodes.add(nodeId);
            }
            
            renderRegisterHierarchy();
        }
        
        // ÂïèÈ°åÈõÜÁÆ°ÁêÜ
        function showNewBookDialog() {
            const dialogBody = `
                <div class="form-group">
                    <label class="form-label">ÂïèÈ°åÈõÜÂêç</label>
                    <input type="text" class="form-control" id="newBookName" placeholder="ÂïèÈ°åÈõÜÂêç„ÇíÂÖ•Âäõ">
                </div>
            `;
            
            showDialog('Êñ∞Ë¶èÂïèÈ°åÈõÜ‰ΩúÊàê', dialogBody, () => {
                const name = document.getElementById('newBookName').value;
                if (!name) {
                    alert('ÂïèÈ°åÈõÜÂêç„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                    return;
                }
                
                const bookId = 'book_' + Date.now();
                books[bookId] = {
                    id: bookId,
                    name: name,
                    examType: 'gyousei',
                    structure: {},
                    createdAt: new Date().toISOString()
                };
                
                saveBooksToStorage();
                renderBookCards();
                renderRegisterHierarchy();
                closeDialog();
                alert('‰ΩúÊàê„Åó„Åæ„Åó„Åü');
            });
        }
        
        function addHierarchy(bookId, parentPath, type, event) {
            event.stopPropagation();
            
            let dialogBody = `
                <div class="form-group">
                    <label class="form-label">${getTypeLabel(type)}„ÅÆÂêçÂâç</label>
                    <input type="text" class="form-control" id="hierarchyName" placeholder="ÂêçÂâç„ÇíÂÖ•Âäõ">
                </div>
            `;
            
            if (type === 'chapter' || type === 'section' || type === 'subsection') {
                dialogBody += `
                    <div class="form-group">
                        <label class="form-label">ÂïèÈ°åÊï∞Ôºà‰ªªÊÑèÔºâ</label>
                        <input type="number" class="form-control" id="questionCount" min="0" placeholder="ÂïèÈ°åÊï∞„ÇíÂÖ•ÂäõÔºàÁ©∫Ê¨ÑÂèØÔºâ">
                    </div>
                `;
            }
            
            showDialog(`${getTypeLabel(type)}„ÇíËøΩÂä†`, dialogBody, () => {
                const name = document.getElementById('hierarchyName').value;
                if (!name) {
                    alert('ÂêçÂâç„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                    return;
                }
                
                let questions = null;
                if (type === 'chapter' || type === 'section' || type === 'subsection') {
                    const count = document.getElementById('questionCount').value;
                    if (count && !isNaN(count) && parseInt(count) > 0) {
                        questions = [];
                        for (let i = 1; i <= parseInt(count); i++) {
                            questions.push(i);
                        }
                    }
                }
                
                const book = books[bookId];
                let target = book.structure;
                
                if (parentPath) {
                    const pathArray = parentPath.split('/');
                    pathArray.forEach(p => {
                        if (target[p]) {
                            if (!target[p].children) {
                                target[p].children = {};
                            }
                            target = target[p].children;
                        }
                    });
                }
                
                if (questions) {
                    target[name] = {
                        type: type,
                        questions: questions,
                        children: {}
                    };
                } else {
                    target[name] = {
                        type: type,
                        children: {}
                    };
                }
                
                saveBooksToStorage();
                renderBookCards();
                renderRegisterHierarchy();
                closeDialog();
            });
        }
        
        function editHierarchy(bookId, path, event) {
            event.stopPropagation();
            
            const book = books[bookId];
            const pathArray = path.split('/');
            let current = book.structure;
            let lastKey = pathArray[pathArray.length - 1];
            
            for (let i = 0; i < pathArray.length - 1; i++) {
                current = current[pathArray[i]].children || {};
            }
            
            const item = current[lastKey];
            if (!item) return;
            
            let dialogBody = `
                <div class="form-group">
                    <label class="form-label">ÂêçÁß∞</label>
                    <input type="text" class="form-control" id="editName" value="${lastKey}">
                </div>
            `;
            
            if (item.questions) {
                dialogBody += `
                    <div class="form-group">
                        <label class="form-label">ÂïèÈ°åÊï∞</label>
                        <input type="number" class="form-control" id="editQuestionCount" value="${item.questions.length}" min="1">
                    </div>
                `;
            }
            
            showDialog('Á∑®ÈõÜ', dialogBody, () => {
                const newName = document.getElementById('editName').value;
                if (!newName) {
                    alert('ÂêçÂâç„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                    return;
                }
                
                if (newName !== lastKey) {
                    current[newName] = current[lastKey];
                    delete current[lastKey];
                }
                
                if (item.questions) {
                    const newCount = parseInt(document.getElementById('editQuestionCount').value);
                    if (newCount && newCount > 0) {
                        const questions = [];
                        for (let i = 1; i <= newCount; i++) {
                            questions.push(i);
                        }
                        current[newName].questions = questions;
                    }
                }
                
                saveBooksToStorage();
                renderBookCards();
                renderRegisterHierarchy();
                closeDialog();
            });
        }
        
        function deleteHierarchy(bookId, path, event) {
            event.stopPropagation();
            
            if (!confirm('„Åì„ÅÆÈ†ÖÁõÆ„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü')) return;
            
            const book = books[bookId];
            const pathArray = path.split('/');
            
            if (pathArray.length === 1) {
                delete book.structure[pathArray[0]];
            } else {
                let target = book.structure;
                for (let i = 0; i < pathArray.length - 1; i++) {
                    if (target[pathArray[i]]) {
                        if (i === pathArray.length - 2) {
                            delete target[pathArray[i]].children[pathArray[pathArray.length - 1]];
                        } else {
                            target = target[pathArray[i]].children || {};
                        }
                    }
                }
            }
            
            saveBooksToStorage();
            renderBookCards();
            renderRegisterHierarchy();
        }
        
        function deleteBook(bookId, event) {
            event.stopPropagation();
            
            if (!confirm('„Åì„ÅÆÂïèÈ°åÈõÜ„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü')) return;
            
            delete books[bookId];
            saveBooksToStorage();
            renderBookCards();
            renderRegisterHierarchy();
        }
        
        function showDialog(title, body, onConfirm) {
            document.getElementById('dialogTitle').textContent = title;
            document.getElementById('dialogBody').innerHTML = body;
            document.getElementById('dialogConfirmBtn').onclick = onConfirm;
            document.getElementById('dialogOverlay').style.display = 'block';
            document.getElementById('inputDialog').style.display = 'block';
        }
        
        function closeDialog() {
            document.getElementById('dialogOverlay').style.display = 'none';
            document.getElementById('inputDialog').style.display = 'none';
        }
        
        function getTypeLabel(type) {
            const labels = {
                'subject': 'ÁßëÁõÆ',
                'chapter': 'Á´†',
                'section': 'ÁØÄ',
                'subsection': 'È†Ö'
            };
            return labels[type] || type;
        }
        
        function clearAllData() {
            if (confirm('„Åô„Åπ„Å¶„ÅÆ„Éá„Éº„Çø„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü„Åì„ÅÆÊìç‰Ωú„ÅØÂèñ„ÇäÊ∂à„Åõ„Åæ„Åõ„Çì„ÄÇ')) {
                localStorage.clear();
                location.reload();
            }
        }
        
        function calculateOverallProgress() {
            let totalQuestions = 0;
            let uniqueAnswered = new Set();
            let totalAnswered = 0;
            let totalCorrect = 0;
            
            Object.values(books).forEach(book => {
                totalQuestions += countQuestionsInBook(book);
            });
            
            allRecords.forEach(record => {
                totalAnswered += record.stats.total || 0;
                totalCorrect += record.stats.correct || 0;
                
                Object.entries(record.questions).forEach(([num, state]) => {
                    if (state.state !== null) {
                        const key = `${record.bookId}_${record.path.join('/')}_${num}`;
                        uniqueAnswered.add(key);
                    }
                });
            });
            
            const uniqueAnsweredCount = uniqueAnswered.size;
            const overallRate = totalAnswered > 0 ? Math.round((totalCorrect / totalAnswered) * 100) : 0;
            const progressPercentage = totalQuestions > 0 ? Math.min(100, Math.round((uniqueAnsweredCount / totalQuestions) * 100)) : 0;
            
            return {
                totalQuestions,
                totalAnswered,
                totalCorrect,
                uniqueAnsweredCount,
                overallRate,
                progressPercentage
            };
        }
        
        function countQuestionsInBook(book) {
            let count = 0;
            
            function traverse(structure) {
                Object.values(structure).forEach(item => {
                    if (item.questions) {
                        count += item.questions.length;
                    }
                    if (item.children) {
                        traverse(item.children);
                    }
                });
            }
            
            traverse(book.structure);
            return count;
        }
